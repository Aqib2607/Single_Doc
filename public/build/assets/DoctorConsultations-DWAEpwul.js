import{r,j as e,B as m,X as I}from"./app-DDp1VRdM.js";import{H as P}from"./Helmet-ClAn1GjW.js";import{C as A,b as L,c as $,d as z,a as B}from"./card-BO8lRk2y.js";import{I as u}from"./input-Csg_LqjO.js";import{L as c}from"./label-DFegoNLu.js";import{T as U}from"./textarea-BxVYU_5P.js";import{S as O,a as q,b as H,c as R,d as V}from"./select-C97nOeoW.js";import{N as M,F as J}from"./Footer-CzA1FT1g.js";import{D as X}from"./DoctorSidebar-CL74N0ZF.js";import{S as G}from"./stethoscope-Cibyf-qp.js";import{P as K}from"./plus-B6pZlKuq.js";import{T as Q}from"./trash-2-BUHX4Ix7.js";import"./index-BdQq_4o_.js";import"./index-DVXevHvX.js";import"./Combination-CxE0D5Hp.js";import"./index-DNb4JNhW.js";import"./chevron-down-DYaBO32e.js";import"./users-BSNMllLh.js";import"./clock-BWKJBK-g.js";import"./file-text-JVw7cimo.js";import"./message-square-DqeSTCJl.js";import"./pill-h8e8mSQV.js";const we=()=>{const[g,_]=r.useState([]),[f,S]=r.useState([]),[k,j]=r.useState(!1),[s,i]=r.useState({patient_id:"",consultation_date:"",diagnosis:"",treatment:"",notes:"",follow_up_date:"",doctor_id:""}),[w,b]=r.useState(!1),[N,n]=r.useState(""),[D,x]=r.useState("");r.useEffect(()=>{h(),T()},[]);const h=async()=>{try{const t=localStorage.getItem("token");console.log("Fetching consultations with token:",t?"Present":"Missing");const a=await fetch("/api/consultations",{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(console.log("Consultations response status:",a.status),a.ok){const o=await a.json();console.log("Consultations data:",o),_(o)}else{const o=await a.text();console.error("Consultations error:",a.status,o)}}catch(t){console.error("Error fetching consultations:",t)}},T=async()=>{try{const t=localStorage.getItem("token"),a=await fetch("/api/patients",{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(a.ok){const o=await a.json();S(o)}}catch(t){console.error("Error fetching patients:",t)}},F=async t=>{if(t.preventDefault(),n(""),!s.patient_id||!s.consultation_date||!s.diagnosis){n("Please fill in all required fields (Patient, Date, and Diagnosis)");return}const a=new Date(s.consultation_date),o=new Date,d=new Date;if(d.setDate(o.getDate()+30),a>d){n("Consultation date cannot be more than 30 days in the future");return}if(s.follow_up_date&&new Date(s.follow_up_date)<=a){n("Follow-up date must be after the consultation date");return}b(!0);try{const l=localStorage.getItem("token"),p={...s};delete p.doctor_id,console.log("Submitting consultation:",{submitData:p});const C=await fetch("/api/consultations",{method:"POST",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(p)});if(C.ok)await h(),v(),n(""),x("Consultation added successfully!"),setTimeout(()=>x(""),3e3);else{const y=await C.json().catch(()=>({message:"Unknown error occurred"}));console.error("Error response:",y),n(y.message||"Failed to save consultation. Please try again.")}}catch(l){console.error("Network error details:",l),n("Network error: "+l.message)}finally{b(!1)}},E=async t=>{if(console.log("Delete consultation ID:",t),!t){alert("Invalid consultation ID");return}if(confirm("Are you sure you want to delete this consultation?"))try{const a=localStorage.getItem("token");console.log("Deleting consultation with URL:",`/api/consultations/${t}`);const o=await fetch(`/api/consultations/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}});o.ok?(h(),alert("Consultation deleted successfully!")):(console.error("Delete failed with status:",o.status),alert("Failed to delete consultation"))}catch(a){console.error("Error deleting consultation:",a),alert("Error deleting consultation")}},v=()=>{i({patient_id:"",consultation_date:"",diagnosis:"",treatment:"",notes:"",follow_up_date:"",doctor_id:""}),j(!1),n(""),x("")};return e.jsxs(e.Fragment,{children:[e.jsx(P,{children:e.jsx("title",{children:"Consultations - Doctor Dashboard"})}),e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(M,{}),e.jsxs("div",{className:"flex pt-20",children:[e.jsx(X,{}),e.jsx("main",{className:"flex-1 px-6 py-8",children:e.jsxs("div",{className:"container mx-auto max-w-6xl",children:[e.jsxs("div",{className:"mb-8 animate-fade-in-up",children:[e.jsx("h1",{className:"text-4xl font-display font-bold text-gradient mb-4",children:"Consultations"}),e.jsx("p",{className:"text-xl text-muted-foreground",children:"Manage patient consultations and diagnoses"})]}),e.jsxs(A,{className:"shadow-card border-border bg-card",children:[e.jsxs(L,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5 text-primary"}),"Consultation Records"]}),e.jsx(z,{children:"View and manage consultation history"})]}),e.jsxs(m,{onClick:()=>j(!0),className:"gradient-primary shadow-elegant",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"New Consultation"]})]}),e.jsxs(B,{children:[k&&e.jsxs("form",{onSubmit:F,className:"mb-6 p-4 border border-border rounded-lg bg-muted/30",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"New Consultation"}),e.jsx(m,{type:"button",onClick:v,variant:"ghost",size:"sm",children:e.jsx(I,{className:"h-4 w-4"})})]}),N&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md text-red-700 text-sm",children:N}),D&&e.jsx("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-md text-green-700 text-sm",children:D}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{children:"Patient *"}),e.jsxs(O,{value:s.patient_id,onValueChange:t=>i({...s,patient_id:t}),children:[e.jsx(q,{children:e.jsx(H,{placeholder:"Select patient"})}),e.jsx(R,{children:f.map(t=>e.jsx(V,{value:t.patient_id.toString(),children:t.name},t.patient_id))})]})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Consultation Date *"}),e.jsx(u,{type:"date",value:s.consultation_date,onChange:t=>i({...s,consultation_date:t.target.value}),max:new Date(Date.now()+30*24*60*60*1e3).toISOString().split("T")[0],required:!0})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Diagnosis *"}),e.jsx(u,{value:s.diagnosis,onChange:t=>i({...s,diagnosis:t.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Treatment"}),e.jsx(u,{value:s.treatment,onChange:t=>i({...s,treatment:t.target.value})})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Follow-up Date"}),e.jsx(u,{type:"date",value:s.follow_up_date,onChange:t=>i({...s,follow_up_date:t.target.value}),min:s.consultation_date||new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(c,{children:"Notes"}),e.jsx(U,{value:s.notes,onChange:t=>i({...s,notes:t.target.value})})]}),e.jsx("div",{className:"col-span-2",children:e.jsx(m,{type:"submit",className:"w-full",disabled:w,children:w?"Saving...":"Add Consultation"})})]})]}),e.jsxs("div",{className:"space-y-4",children:[g.map(t=>{const a=f.find(l=>l.patient_id===t.patient_id),o=new Date(t.consultation_date).toLocaleDateString(),d=t.follow_up_date?new Date(t.follow_up_date).toLocaleDateString():null;return e.jsxs("div",{className:"flex justify-between items-start p-4 border border-border rounded-lg bg-muted/50 hover:bg-muted transition-smooth",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-foreground",children:a?a.name:`Patient ID: ${t.patient_id}`}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Date: ",o]}),e.jsxs("p",{className:"text-sm text-primary font-medium",children:["Diagnosis: ",t.diagnosis]}),t.treatment&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Treatment: ",t.treatment]}),d&&e.jsxs("p",{className:"text-sm text-blue-600",children:["Follow-up: ",d]}),t.notes&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1 italic",children:t.notes})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(m,{onClick:()=>E(t.id),size:"sm",variant:"outline",className:"text-red-600 hover:text-red-700",children:e.jsx(Q,{className:"h-4 w-4"})})})]},t.id)}),g.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:'No consultations found. Click "New Consultation" to create your first consultation record.'})]})]})]})]})})]}),e.jsx(J,{})]})]})};export{we as default};
