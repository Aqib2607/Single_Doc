import{r as n,j as e,B as m,X as P}from"./app-Ctcvl0L3.js";import{H as F}from"./Helmet-Co23iFK2.js";import{C as z,b as A,c as $,d as B,a as L}from"./card-DZzBpZMV.js";import{I as x}from"./input-Ljzp5E3d.js";import{L as d}from"./label-DkcLJd5U.js";import{T as q}from"./textarea-CyBfWePp.js";import{S as U,a as H,b as V,c as O,d as R}from"./select-kcfAJY73.js";import{N as J,F as M}from"./Footer-Dg67bZa1.js";import{D as X}from"./DoctorSidebar-B20k-3e_.js";import{S as G}from"./stethoscope-B07MkWAq.js";import{P as K}from"./plus-ChQ4m0mi.js";import{S as Q}from"./square-pen-C2wLsbA_.js";import{T as W}from"./trash-2-D3X408Vn.js";import"./index-BdQq_4o_.js";import"./index-BuAs8_WM.js";import"./Combination-CjoguCJq.js";import"./index-n9-Tr9Se.js";import"./chevron-down-CDPvgecV.js";import"./users-DMPgEr1v.js";import"./file-text-DXNCTGNo.js";import"./message-square-C8sKfbal.js";import"./pill-B2wRk4OR.js";const we=()=>{const[g,S]=n.useState([]),[f,y]=n.useState([]),[D,h]=n.useState(!1),[l,j]=n.useState(null),[a,r]=n.useState({patient_id:"",consultation_date:"",diagnosis:"",treatment:"",notes:"",follow_up_date:"",doctor_id:""}),[N,w]=n.useState(!1),[_,i]=n.useState("");n.useEffect(()=>{p(),k();const t=localStorage.getItem("doctor_id")||"1";r(s=>({...s,doctor_id:t}))},[]);const p=async()=>{try{const t=localStorage.getItem("token"),s=await fetch("/api/consultations",{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(s.ok){const o=await s.json();S(o)}}catch(t){console.error("Error fetching consultations:",t)}},k=async()=>{try{const t=localStorage.getItem("token"),s=await fetch("/api/patients",{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(s.ok){const o=await s.json();y(o)}}catch(t){console.error("Error fetching patients:",t)}},E=async t=>{if(t.preventDefault(),i(""),!a.patient_id||!a.consultation_date||!a.diagnosis){i("Please fill in all required fields (Patient, Date, and Diagnosis)");return}w(!0);try{const s=localStorage.getItem("token"),o=l?`/api/consultations/${l.id}`:"/api/consultations",c=l?"PUT":"POST",u={...a,doctor_id:a.doctor_id||localStorage.getItem("doctor_id")||"1"};console.log("Submitting consultation:",{url:o,method:c,submitData:u});const v=await fetch(o,{method:c,headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(u)});if(v.ok)await p(),b(),i(""),alert(l?"Consultation updated successfully!":"Consultation added successfully!");else{const C=await v.json().catch(()=>({message:"Unknown error occurred"}));console.error("Error response:",C),i(C.message||"Failed to save consultation. Please try again.")}}catch(s){console.error("Network error details:",s),i("Network error: "+s.message)}finally{w(!1)}},I=t=>{var s,o;j(t),r({patient_id:((s=t.patient_id)==null?void 0:s.toString())||"",consultation_date:t.consultation_date||"",diagnosis:t.diagnosis||"",treatment:t.treatment||"",notes:t.notes||"",follow_up_date:t.follow_up_date||"",doctor_id:((o=t.doctor_id)==null?void 0:o.toString())||localStorage.getItem("doctor_id")||"1"}),h(!0),i("")},T=async t=>{if(confirm("Are you sure you want to delete this consultation?"))try{const s=localStorage.getItem("token");(await fetch(`/api/consultations/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}})).ok&&(p(),alert("Consultation deleted successfully!"))}catch(s){console.error("Error deleting consultation:",s)}},b=()=>{const t=localStorage.getItem("doctor_id")||"1";r({patient_id:"",consultation_date:"",diagnosis:"",treatment:"",notes:"",follow_up_date:"",doctor_id:t}),j(null),h(!1),i("")};return e.jsxs(e.Fragment,{children:[e.jsx(F,{children:e.jsx("title",{children:"Consultations - Doctor Dashboard"})}),e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(J,{}),e.jsxs("div",{className:"flex pt-20",children:[e.jsx(X,{}),e.jsx("main",{className:"flex-1 px-6 py-8",children:e.jsxs("div",{className:"container mx-auto max-w-6xl",children:[e.jsxs("div",{className:"mb-8 animate-fade-in-up",children:[e.jsx("h1",{className:"text-4xl font-display font-bold text-gradient mb-4",children:"Consultations"}),e.jsx("p",{className:"text-xl text-muted-foreground",children:"Manage patient consultations and diagnoses"})]}),e.jsxs(z,{className:"shadow-card border-border bg-card",children:[e.jsxs(A,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5 text-primary"}),"Consultation Records"]}),e.jsx(B,{children:"View and manage consultation history"})]}),e.jsxs(m,{onClick:()=>h(!0),className:"gradient-primary shadow-elegant",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"New Consultation"]})]}),e.jsxs(L,{children:[D&&e.jsxs("form",{onSubmit:E,className:"mb-6 p-4 border border-border rounded-lg bg-muted/30",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:l?"Edit Consultation":"New Consultation"}),e.jsx(m,{type:"button",onClick:b,variant:"ghost",size:"sm",children:e.jsx(P,{className:"h-4 w-4"})})]}),_&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md text-red-700 text-sm",children:_}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{children:"Patient *"}),e.jsxs(U,{value:a.patient_id,onValueChange:t=>r({...a,patient_id:t}),children:[e.jsx(H,{children:e.jsx(V,{placeholder:"Select patient"})}),e.jsx(O,{children:f.map(t=>e.jsx(R,{value:t.id.toString(),children:t.name},t.id))})]})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Consultation Date *"}),e.jsx(x,{type:"date",value:a.consultation_date,onChange:t=>r({...a,consultation_date:t.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Diagnosis *"}),e.jsx(x,{value:a.diagnosis,onChange:t=>r({...a,diagnosis:t.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Treatment"}),e.jsx(x,{value:a.treatment,onChange:t=>r({...a,treatment:t.target.value})})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Follow-up Date"}),e.jsx(x,{type:"date",value:a.follow_up_date,onChange:t=>r({...a,follow_up_date:t.target.value})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(d,{children:"Notes"}),e.jsx(q,{value:a.notes,onChange:t=>r({...a,notes:t.target.value})})]}),e.jsx("div",{className:"col-span-2",children:e.jsx(m,{type:"submit",className:"w-full",disabled:N,children:N?"Saving...":l?"Update Consultation":"Add Consultation"})})]})]}),e.jsxs("div",{className:"space-y-4",children:[g.map(t=>{const s=f.find(u=>u.id===t.patient_id),o=new Date(t.consultation_date).toLocaleDateString(),c=t.follow_up_date?new Date(t.follow_up_date).toLocaleDateString():null;return e.jsxs("div",{className:"flex justify-between items-start p-4 border border-border rounded-lg bg-muted/50 hover:bg-muted transition-smooth",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-foreground",children:s?s.name:`Patient ID: ${t.patient_id}`}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Date: ",o]}),e.jsxs("p",{className:"text-sm text-primary font-medium",children:["Diagnosis: ",t.diagnosis]}),t.treatment&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Treatment: ",t.treatment]}),c&&e.jsxs("p",{className:"text-sm text-blue-600",children:["Follow-up: ",c]}),t.notes&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1 italic",children:t.notes})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{onClick:()=>I(t),size:"sm",variant:"outline",children:e.jsx(Q,{className:"h-4 w-4"})}),e.jsx(m,{onClick:()=>T(t.id),size:"sm",variant:"outline",className:"text-red-600 hover:text-red-700",children:e.jsx(W,{className:"h-4 w-4"})})]})]},t.id)}),g.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:'No consultations found. Click "New Consultation" to create your first consultation record.'})]})]})]})]})})]}),e.jsx(M,{})]})]})};export{we as default};
