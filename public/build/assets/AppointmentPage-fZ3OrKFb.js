import{r,j as e,l as _,C as O,B as M}from"./app-DDp1VRdM.js";import{I as h}from"./input-Csg_LqjO.js";import{L as l}from"./label-DFegoNLu.js";import{T as B}from"./textarea-BxVYU_5P.js";import{S as F,a as P,b as T,c as A,d as o}from"./select-C97nOeoW.js";import{C as z,b as V,c as R,d as $,a as q}from"./card-BO8lRk2y.js";import{C as G}from"./checkbox-BgTIbMsk.js";import{S as U}from"./stethoscope-Cibyf-qp.js";import{C as H}from"./chevron-down-DYaBO32e.js";import{S as J}from"./search-4U1cZxNL.js";import{L as D,T as E}from"./triangle-alert-DZrQwD39.js";import{N as Y,U as L,F as K}from"./Footer-CzA1FT1g.js";import{C as Q}from"./clock-BWKJBK-g.js";import{F as W}from"./file-text-JVw7cimo.js";import"./index-BdQq_4o_.js";import"./index-DVXevHvX.js";import"./Combination-CxE0D5Hp.js";import"./index-DNb4JNhW.js";const X=({value:N,onValueChange:d,placeholder:k="Select a doctor"})=>{const[c,v]=r.useState([]),[y,b]=r.useState([]),[u,f]=r.useState(!1),[n,j]=r.useState(!1),[w,S]=r.useState(null),[p,i]=r.useState(""),C=r.useRef(null),s=r.useRef(null),a=c.find(t=>t.doctor_id===N);r.useEffect(()=>{m()},[]),r.useEffect(()=>{const t=c.filter(g=>g.name.toLowerCase().includes(p.toLowerCase())||g.specialization.toLowerCase().includes(p.toLowerCase()));b(t)},[c,p]),r.useEffect(()=>{const t=g=>{C.current&&!C.current.contains(g.target)&&(f(!1),i(""))};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]);const m=async()=>{j(!0),S(null);try{const t=await fetch("/api/doctors");if(!t.ok)throw new Error("Failed to fetch doctors");const g=await t.json();v(g),b(g)}catch(t){S(t instanceof Error?t.message:"Failed to load doctors")}finally{j(!1)}},x=()=>{f(!u),u||setTimeout(()=>{var t;return(t=s.current)==null?void 0:t.focus()},100)},I=t=>{d(t.doctor_id),f(!1),i("")};return e.jsxs("div",{className:"relative",ref:C,children:[e.jsxs("button",{type:"button",onClick:x,className:"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50","aria-expanded":u?"true":"false","aria-haspopup":"listbox","aria-label":"Select doctor",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4 text-muted-foreground"}),a?e.jsxs("span",{className:"truncate",children:[a.name," - ",a.specialization]}):e.jsx("span",{className:"text-muted-foreground",children:k})]}),e.jsx(H,{className:`h-4 w-4 transition-transform ${u?"rotate-180":""}`})]}),u&&e.jsxs("div",{className:"absolute z-50 mt-1 w-full rounded-md border bg-popover p-0 shadow-md animate-in fade-in-0 zoom-in-95",children:[e.jsx("div",{className:"p-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx("input",{ref:s,type:"text",placeholder:"Search doctors...",value:p,onChange:t=>i(t.target.value),className:"h-9 w-full rounded-md border border-input bg-background pl-8 pr-3 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2","aria-label":"Search doctors"})]})}),e.jsx("div",{className:"max-h-60 overflow-auto",children:n?e.jsxs("div",{className:"flex items-center justify-center py-6",children:[e.jsx(D,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{className:"ml-2 text-sm text-muted-foreground",children:"Loading doctors..."})]}):w?e.jsxs("div",{className:"px-3 py-6 text-center",children:[e.jsx("p",{className:"text-sm text-destructive",children:w}),e.jsx("button",{onClick:m,className:"mt-2 text-sm text-primary hover:underline",children:"Try again"})]}):y.length===0?e.jsx("div",{className:"px-3 py-6 text-center text-sm text-muted-foreground",children:p?"No doctors found matching your search.":"No doctors available."}):e.jsx("div",{role:"listbox","aria-label":"Doctor options",children:y.map(t=>e.jsx("button",{type:"button",onClick:()=>I(t),className:`w-full px-3 py-2 text-left text-sm hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none ${N===t.doctor_id?"bg-accent text-accent-foreground":""}`,role:"option","aria-selected":N===t.doctor_id?"true":"false",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:t.name}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.specialization," • $",t.consultation_fee]})]})},t.doctor_id))})})]})]})},fe=()=>{const N=_(),[d,k]=r.useState({name:"",email:"",phone:"",gender:""}),[c,v]=r.useState({name:"",email:"",phone:"",gender:"",date:"",time:"",doctor_id:void 0,consultationType:"",reason:"",termsAccepted:!1}),[y,b]=r.useState(!1),[u,f]=r.useState(!0),[n,j]=r.useState({}),[w,S]=r.useState(""),p=async s=>{s.preventDefault(),b(!0),j({}),S("");try{const a=localStorage.getItem("token"),m=await fetch("/api/book-appointment",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:a?`Bearer ${a}`:""},body:JSON.stringify(c)}),x=await m.json();m.ok&&x.success?(S(x.message),v({name:"",email:"",phone:"",gender:"",date:"",time:"",doctor_id:void 0,consultationType:"",reason:"",termsAccepted:!1}),d.name&&setTimeout(()=>{N("/patient-dashboard")},2e3)):j(x.errors||{general:[x.message]})}catch{j({general:["Network error. Please try again."]})}finally{b(!1)}},i=(s,a)=>{v(m=>({...m,[s]:a}))},C=s=>{v(a=>({...a,doctor_id:s}))};return r.useEffect(()=>{(async()=>{try{const a=localStorage.getItem("token");if(!a){f(!1);return}const m=await fetch("/api/patient/profile",{headers:{Authorization:`Bearer ${a}`,Accept:"application/json"}});if(m.ok){const x=await m.json();k(x)}}catch(a){console.error("Failed to load patient profile:",a)}finally{f(!1)}})()},[]),e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(Y,{}),e.jsx("div",{className:"pt-20",children:e.jsx("div",{className:"container mx-auto px-4 py-16",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-display font-bold text-gradient mb-6",children:"Book Your Appointment"}),e.jsx("p",{className:"text-xl text-muted-foreground max-w-2xl mx-auto",children:"Schedule your consultation with Dr. Sarah Mitchell and take the first step towards better health"})]}),e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs(z,{className:"shadow-card border-border bg-card",children:[e.jsxs(V,{children:[e.jsxs(R,{className:"flex items-center gap-2 text-foreground",children:[e.jsx(O,{className:"h-5 w-5 text-primary"}),"Appointment Details"]}),e.jsx($,{className:"text-muted-foreground",children:"Fill in your information to schedule an appointment"})]}),e.jsx(q,{children:e.jsxs("form",{onSubmit:p,className:"space-y-6",children:[w&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-5 w-5 text-green-600",children:"✓"}),e.jsx("p",{className:"text-green-800 font-medium",children:w})]})}),n.general&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(E,{className:"h-5 w-5 text-red-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-red-800 mb-1",children:"Booking Error"}),n.general.map((s,a)=>e.jsx("p",{className:"text-sm text-red-700",children:s},a))]})]})}),!d.name&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-foreground flex items-center gap-2",children:[e.jsx(L,{className:"h-5 w-5"}),"Personal Information"]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"name",children:"Full Name *"}),e.jsx(h,{id:"name",value:c.name||"",onChange:s=>i("name",s.target.value),required:!0}),n.name&&e.jsx("p",{className:"text-sm text-red-600",children:n.name[0]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"phone",children:"Phone Number *"}),e.jsx(h,{id:"phone",type:"tel",value:c.phone||"",onChange:s=>i("phone",s.target.value),required:!0}),n.phone&&e.jsx("p",{className:"text-sm text-red-600",children:n.phone[0]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"email",children:"Email (Optional)"}),e.jsx(h,{id:"email",type:"email",value:c.email||"",onChange:s=>i("email",s.target.value)}),n.email&&e.jsx("p",{className:"text-sm text-red-600",children:n.email[0]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"gender",children:"Gender *"}),e.jsxs(F,{onValueChange:s=>i("gender",s),children:[e.jsx(P,{children:e.jsx(T,{placeholder:"Select gender"})}),e.jsxs(A,{children:[e.jsx(o,{value:"male",children:"Male"}),e.jsx(o,{value:"female",children:"Female"}),e.jsx(o,{value:"other",children:"Other"}),e.jsx(o,{value:"prefer-not-to-say",children:"Prefer not to say"})]})]}),n.gender&&e.jsx("p",{className:"text-sm text-red-600",children:n.gender[0]})]})]})]}),d.name&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx(L,{className:"h-4 w-4"}),"Patient Information"]}),u?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(D,{className:"h-4 w-4 animate-spin"}),"Loading patient details..."]}):e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"text-sm text-gray-600",children:"Full Name"}),e.jsx(h,{value:d.name,readOnly:!0,className:"bg-gray-100 cursor-not-allowed"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"text-sm text-gray-600",children:"Email"}),e.jsx(h,{value:d.email,readOnly:!0,className:"bg-gray-100 cursor-not-allowed"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"text-sm text-gray-600",children:"Phone"}),e.jsx(h,{value:d.phone,readOnly:!0,className:"bg-gray-100 cursor-not-allowed"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"text-sm text-gray-600",children:"Gender"}),e.jsx(h,{value:d.gender?d.gender.charAt(0).toUpperCase()+d.gender.slice(1):"",readOnly:!0,className:"bg-gray-100 cursor-not-allowed"})]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"date",children:"Preferred Date"}),e.jsx(h,{id:"date",type:"date",value:c.date,onChange:s=>i("date",s.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{htmlFor:"time",className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4"}),"Preferred Time"]}),e.jsxs(F,{onValueChange:s=>i("time",s),children:[e.jsx(P,{children:e.jsx(T,{placeholder:"Select time"})}),e.jsxs(A,{children:[e.jsx(o,{value:"09:00",children:"9:00 AM"}),e.jsx(o,{value:"10:00",children:"10:00 AM"}),e.jsx(o,{value:"11:00",children:"11:00 AM"}),e.jsx(o,{value:"14:00",children:"2:00 PM"}),e.jsx(o,{value:"15:00",children:"3:00 PM"}),e.jsx(o,{value:"16:00",children:"4:00 PM"})]})]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"doctor",children:"Select Doctor"}),e.jsx(X,{value:c.doctor_id,onValueChange:C,placeholder:"Choose a doctor"}),n.doctor_id&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:n.doctor_id[0]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"consultationType",children:"Consultation Type"}),e.jsxs(F,{onValueChange:s=>i("consultationType",s),children:[e.jsx(P,{children:e.jsx(T,{placeholder:"Select consultation type"})}),e.jsxs(A,{children:[e.jsx(o,{value:"in-person",children:"In-Person Visit"}),e.jsx(o,{value:"telemedicine",children:"Telemedicine"}),e.jsx(o,{value:"follow-up",children:"Follow-up"}),e.jsx(o,{value:"consultation",children:"General Consultation"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{htmlFor:"reason",className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),"Reason for Visit"]}),e.jsx(B,{id:"reason",value:c.reason,onChange:s=>i("reason",s.target.value),placeholder:"Please describe your symptoms or reason for the appointment",rows:4})]}),e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(E,{className:"h-5 w-5 text-red-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-red-800 mb-1",children:"Emergency Notice"}),e.jsx("p",{className:"text-sm text-red-700",children:"If you are experiencing a medical emergency, please call 911 immediately or visit your nearest emergency room. This appointment booking system is not for urgent medical situations."})]})]})}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(G,{id:"terms",checked:c.termsAccepted,onCheckedChange:s=>i("termsAccepted",s),required:!0}),e.jsx(l,{htmlFor:"terms",className:"text-sm leading-relaxed",children:"I agree to the Terms of Service and Privacy Policy. I understand that appointment confirmation is subject to availability and will be confirmed via email or phone."})]}),e.jsx(M,{type:"submit",className:"w-full gradient-primary shadow-elegant hover:shadow-glow",disabled:y||!c.termsAccepted,children:y?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"mr-2 h-4 w-4 animate-spin"}),"Booking Appointment..."]}):"Book Appointment"}),n.termsAccepted&&e.jsx("p",{className:"text-sm text-red-600 text-center",children:n.termsAccepted[0]})]})})]})})]})})}),e.jsx(K,{})]})};export{fe as default};
