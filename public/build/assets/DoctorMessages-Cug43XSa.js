import{r as o,j as e,B as c,X as k}from"./app-BOiF443J.js";import{H as E}from"./Helmet-DoC77Fv0.js";import{C as _,b as T,c as F,d as $,a as I}from"./card-Bt4d10Kd.js";import{I as N}from"./input-BlplRgxQ.js";import{L as x}from"./label-BGESanDY.js";import{T as P}from"./textarea-CR2J13YI.js";import{N as q,F as z}from"./Footer-DJ_vYW1S.js";import{D as U}from"./DoctorSidebar-nMgpw6DO.js";import{M as B}from"./message-square-BXysBFYZ.js";import{P as L}from"./plus-ChoEqHS7.js";import{S as A}from"./square-pen-Myjp8rGJ.js";import{T as H}from"./trash-2-hyiNAzsX.js";import"./index-X9xYpb7J.js";import"./Combination-DFInk1d7.js";import"./users-yyJNI81h.js";import"./clock-DaR8OxtZ.js";import"./stethoscope-BM2yUbWi.js";import"./file-text-BTpC2DMU.js";import"./pill-CpCHYFah.js";const de=()=>{const[h,w]=o.useState([]),[y,l]=o.useState(!1),[i,g]=o.useState(null),[j,p]=o.useState(!1),[f,n]=o.useState(""),[t,d]=o.useState({receiver_id:"",subject:"",message:""});o.useEffect(()=>{m()},[]);const m=async()=>{try{const s=localStorage.getItem("token"),r=await fetch("/api/messages",{headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}});if(r.ok){const a=await r.json();w(a)}}catch(s){console.error("Error fetching messages:",s)}},S=async s=>{if(s.preventDefault(),n(""),!t.receiver_id||!t.subject||!t.message){n("Please fill in all required fields");return}p(!0);try{const r=localStorage.getItem("token"),a=i?`/api/messages/${i.id}`:"/api/messages",v=await fetch(a,{method:i?"PUT":"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify(t)});if(v.ok)await m(),b(),alert(i?"Message updated successfully!":"Message sent successfully!");else{const D=await v.json().catch(()=>({message:"Unknown error occurred"}));n(D.message||"Failed to send message")}}catch(r){n("Network error: "+r.message)}finally{p(!1)}},M=s=>{var r;g(s),d({receiver_id:((r=s.receiver_id)==null?void 0:r.toString())||"",subject:s.subject||"",message:s.message||""}),l(!0),n("")},C=async s=>{if(confirm("Are you sure you want to delete this message?"))try{const r=localStorage.getItem("token");(await fetch(`/api/messages/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`}})).ok&&(m(),alert("Message deleted successfully!"))}catch(r){console.error("Error deleting message:",r)}},b=()=>{d({receiver_id:"",subject:"",message:""}),g(null),l(!1),n("")};return e.jsxs(e.Fragment,{children:[e.jsx(E,{children:e.jsx("title",{children:"Messages - Doctor Dashboard"})}),e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(q,{}),e.jsxs("div",{className:"flex pt-20",children:[e.jsx(U,{}),e.jsx("main",{className:"flex-1 px-6 py-8",children:e.jsxs("div",{className:"container mx-auto max-w-6xl",children:[e.jsxs("div",{className:"mb-8 animate-fade-in-up",children:[e.jsx("h1",{className:"text-4xl font-display font-bold text-gradient mb-4",children:"Messages"}),e.jsx("p",{className:"text-xl text-muted-foreground",children:"Communicate with patients and manage messages"})]}),e.jsxs(_,{className:"shadow-card border-border bg-card",children:[e.jsxs(T,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-5 w-5 text-primary"}),"Patient Messages"]}),e.jsx($,{children:"View and respond to patient communications"})]}),e.jsxs(c,{onClick:()=>l(!0),className:"gradient-primary shadow-elegant",children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"New Message"]})]}),e.jsxs(I,{children:[y&&e.jsxs("form",{onSubmit:S,className:"mb-6 p-4 border border-border rounded-lg bg-muted/30",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:i?"Edit Message":"New Message"}),e.jsx(c,{type:"button",onClick:b,variant:"ghost",size:"sm",children:e.jsx(k,{className:"h-4 w-4"})})]}),f&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md text-red-700 text-sm",children:f}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx(x,{children:"Receiver ID *"}),e.jsx(N,{value:t.receiver_id,onChange:s=>d({...t,receiver_id:s.target.value}),placeholder:"Enter receiver ID",required:!0})]}),e.jsxs("div",{children:[e.jsx(x,{children:"Subject *"}),e.jsx(N,{value:t.subject,onChange:s=>d({...t,subject:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(x,{children:"Message *"}),e.jsx(P,{value:t.message,onChange:s=>d({...t,message:s.target.value}),rows:4,required:!0})]}),e.jsx("div",{children:e.jsx(c,{type:"submit",className:"w-full",disabled:j,children:j?"Sending...":i?"Update Message":"Send Message"})})]})]}),e.jsxs("div",{className:"space-y-4",children:[h.map(s=>{var a,u;const r=new Date(s.created_at).toLocaleDateString();return e.jsxs("div",{className:"flex justify-between items-start p-4 border border-border rounded-lg bg-muted/50 hover:bg-muted transition-smooth",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full mt-2 ${s.is_read?"bg-muted-foreground":"bg-primary animate-pulse"}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-foreground",children:s.subject}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-2",children:["From: ",((a=s.sender)==null?void 0:a.name)||`User ${s.sender_id}`," | To: ",((u=s.receiver)==null?void 0:u.name)||`User ${s.receiver_id}`]}),e.jsx("p",{className:"text-sm text-foreground",children:s.message}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Date: ",r," | Status: ",s.is_read?"Read":"Unread"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{onClick:()=>M(s),size:"sm",variant:"outline",children:e.jsx(A,{className:"h-4 w-4"})}),e.jsx(c,{onClick:()=>C(s.id),size:"sm",variant:"outline",className:"text-red-600 hover:text-red-700",children:e.jsx(H,{className:"h-4 w-4"})})]})]},s.id)}),h.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:'No messages found. Click "New Message" to send your first message.'})]})]})]})]})})]}),e.jsx(z,{})]})]})};export{de as default};
