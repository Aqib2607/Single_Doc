import{c as J,j as e,B as P,X as Ve,r as a,l as I,m as me,C as _,d as Ye,h as G,P as ee,g as ae,f as W,o as $,i as Xe}from"./app-63SFHjIa.js";import{H as qe}from"./Helmet-C7MJ7xcl.js";import{C as O,b as H,c as B,a as U,d as Je}from"./card-D5r0uYXZ.js";import{U as he,P as Ge,B as te,N as Ke,F as Qe}from"./Footer-DAIF9c2c.js";import{T as ce,L as V}from"./triangle-alert-CbDD4FkI.js";import{D as xe,b as ue,a as pe,c as fe,d as ge}from"./dialog-DOUGUkgN.js";import{I as Ze}from"./input-fVX1XM3m.js";import{E as je}from"./eye-Li6tKG3W.js";import{S as et}from"./search-BV7TQiuO.js";import{C as ne}from"./clock-D4NSwhJ7.js";import{T as Ae}from"./trash-2-y5Z9t80N.js";import{a as tt}from"./index-D6qhZrlk.js";import{c as st}from"./index-BdQq_4o_.js";import{P as Y}from"./pill-Dedl5hRm.js";import{F as X}from"./file-text-NisEOZJR.js";import"./Combination-ca_GfZQ4.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=J("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=J("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=J("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=J("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=J("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=J("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),lt=({isOpen:t,onClose:r,onConfirm:s,title:l,message:n,confirmText:i="Confirm",cancelText:m="Cancel",isLoading:c=!1})=>t?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:r}),e.jsx("div",{className:"relative bg-white rounded-lg shadow-lg max-w-md w-full mx-4 p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(ce,{className:"h-6 w-6 text-red-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:l}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:n}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx(P,{variant:"outline",onClick:r,disabled:c,className:"px-4 py-2",children:m}),e.jsx(P,{variant:"destructive",onClick:s,disabled:c,className:"px-4 py-2",children:c?"Deleting...":i})]})]}),e.jsx("button",{onClick:r,disabled:c,className:"flex-shrink-0 text-gray-400 hover:text-gray-600","aria-label":"Close dialog",children:e.jsx(Ve,{className:"h-5 w-5"})})]})})]}):null,Ee=a.forwardRef(({className:t,...r},s)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:s,className:I("w-full caption-bottom text-sm",t),...r})}));Ee.displayName="Table";const Pe=a.forwardRef(({className:t,...r},s)=>e.jsx("thead",{ref:s,className:I("[&_tr]:border-b",t),...r}));Pe.displayName="TableHeader";const De=a.forwardRef(({className:t,...r},s)=>e.jsx("tbody",{ref:s,className:I("[&_tr:last-child]:border-0",t),...r}));De.displayName="TableBody";const ot=a.forwardRef(({className:t,...r},s)=>e.jsx("tfoot",{ref:s,className:I("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...r}));ot.displayName="TableFooter";const de=a.forwardRef(({className:t,...r},s)=>e.jsx("tr",{ref:s,className:I("border-b transition-colors data-[state=selected]:bg-muted hover:bg-muted/50",t),...r}));de.displayName="TableRow";const M=a.forwardRef(({className:t,...r},s)=>e.jsx("th",{ref:s,className:I("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",t),...r}));M.displayName="TableHead";const F=a.forwardRef(({className:t,...r},s)=>e.jsx("td",{ref:s,className:I("p-4 align-middle [&:has([role=checkbox])]:pr-0",t),...r}));F.displayName="TableCell";const it=a.forwardRef(({className:t,...r},s)=>e.jsx("caption",{ref:s,className:I("mt-4 text-sm text-muted-foreground",t),...r}));it.displayName="TableCaption";const ie=()=>{const{user:t}=me(),[r,s]=a.useState(!1),[l,n]=a.useState([]),[i,m]=a.useState(!1),[c,x]=a.useState(null),[f,u]=a.useState(""),[g,d]=a.useState("all"),[j,p]=a.useState("appointment_date"),[w,N]=a.useState("desc"),S=async()=>{if(r){m(!0),x(null);try{const o=localStorage.getItem("token"),v=await fetch("/api/patient-appointments",{headers:{Authorization:`Bearer ${o}`,Accept:"application/json"}});if(!v.ok)throw new Error("Failed to fetch appointments");const C=await v.json();n(C)}catch(o){x(o instanceof Error?o.message:"Failed to load appointments")}finally{m(!1)}}};a.useEffect(()=>{S()},[r]);const D=a.useMemo(()=>{const o=l.filter(v=>{var k,K;const C=v.doctor.toLowerCase().includes(f.toLowerCase())||((k=v.reason)==null?void 0:k.toLowerCase().includes(f.toLowerCase()))||((K=v.consultation_type)==null?void 0:K.toLowerCase().includes(f.toLowerCase())),E=g==="all"||v.status===g;return C&&E});return o.sort((v,C)=>{var K,Se;let E,k;switch(j){case"appointment_date":E=new Date(v.appointment_date).getTime(),k=new Date(C.appointment_date).getTime();break;case"appointment_time":E=v.appointment_time,k=C.appointment_time;break;case"created_at":E=new Date(v.created_at).getTime(),k=new Date(C.created_at).getTime();break;default:E=((K=v[j])==null?void 0:K.toLowerCase())||"",k=((Se=C[j])==null?void 0:Se.toLowerCase())||""}return w==="asc"?E<k?-1:E>k?1:0:E>k?-1:E<k?1:0}),o},[l,f,g,j,w]),T=o=>{j===o?N(w==="asc"?"desc":"asc"):(p(o),N("desc"))},A=o=>j!==o?e.jsx(at,{className:"h-4 w-4"}):w==="asc"?e.jsx(nt,{className:"h-4 w-4"}):e.jsx(rt,{className:"h-4 w-4"}),L=o=>{switch(o){case"confirmed":return e.jsx(Z,{className:"h-4 w-4 text-green-600"});case"cancelled":return e.jsx(Te,{className:"h-4 w-4 text-red-600"});default:return e.jsx(Q,{className:"h-4 w-4 text-yellow-600"})}},b=o=>{switch(o){case"confirmed":return"text-green-600 bg-green-50 border-green-200";case"cancelled":return"text-red-600 bg-red-50 border-red-200";default:return"text-yellow-600 bg-yellow-50 border-yellow-200"}},h=o=>new Date(o).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"}),y=o=>new Date(`2000-01-01T${o}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});return e.jsxs(xe,{open:r,onOpenChange:s,children:[e.jsx(ue,{asChild:!0,children:e.jsxs(P,{variant:"outline",size:"sm",className:"view-all-button hover:bg-primary hover:text-primary-foreground transition-colors","aria-label":"View all appointments",children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"View All"]})}),e.jsxs(pe,{className:"modal-content max-w-6xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx(fe,{className:"flex-shrink-0",children:e.jsxs(ge,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-5 w-5"}),"All Appointments - ",t==null?void 0:t.name," (ID: ",t==null?void 0:t.id,")"]})}),e.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex-shrink-0 space-y-4 mb-4",children:[e.jsxs("div",{className:"search-filter-container flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(et,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Ze,{placeholder:"Search by doctor, reason, or consultation type...",value:f,onChange:o=>u(o.target.value),className:"search-input pl-10"})]}),e.jsxs("select",{value:g,onChange:o=>d(o.target.value),className:"px-3 py-2 border border-input bg-background rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-ring","aria-label":"Filter appointments by status",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"confirmed",children:"Confirmed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",D.length," of ",l.length," appointments"]})]}),e.jsx("div",{className:"flex-1 overflow-auto",children:i?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(V,{className:"loading-spinner h-6 w-6 animate-spin mr-2"}),e.jsx("span",{children:"Loading appointments..."})]}):c?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Q,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-red-600 mb-4",children:c}),e.jsx(P,{onClick:S,variant:"outline",children:"Try Again"})]}):D.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(_,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 mb-2",children:l.length===0?"No appointments found":"No appointments match your search"}),e.jsx("p",{className:"text-sm text-gray-500",children:l.length===0?"Your appointments will appear here":"Try adjusting your search or filter"})]}):e.jsxs(Ee,{className:"appointments-table",children:[e.jsx(Pe,{children:e.jsxs(de,{children:[e.jsx(M,{className:"sortable-header cursor-pointer hover:bg-muted/50 select-none",onClick:()=>T("appointment_date"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Date",A("appointment_date")]})}),e.jsx(M,{className:"sortable-header cursor-pointer hover:bg-muted/50 select-none",onClick:()=>T("appointment_time"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Time",A("appointment_time")]})}),e.jsx(M,{className:"sortable-header cursor-pointer hover:bg-muted/50 select-none",onClick:()=>T("doctor"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Doctor",A("doctor")]})}),e.jsx(M,{children:"Type"}),e.jsx(M,{children:"Reason"}),e.jsx(M,{className:"sortable-header cursor-pointer hover:bg-muted/50 select-none",onClick:()=>T("status"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Status",A("status")]})}),e.jsx(M,{className:"sortable-header cursor-pointer hover:bg-muted/50 select-none",onClick:()=>T("created_at"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Booked",A("created_at")]})})]})}),e.jsx(De,{children:D.map(o=>e.jsxs(de,{className:"table-row hover:bg-muted/50",children:[e.jsx(F,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:h(o.appointment_date)})]})}),e.jsx(F,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:y(o.appointment_time)})]})}),e.jsx(F,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:o.doctor})]})}),e.jsx(F,{children:o.consultation_type&&e.jsx("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded",children:o.consultation_type.replace("-"," ")})}),e.jsx(F,{children:e.jsx("div",{className:"max-w-xs",children:e.jsx("p",{className:"text-sm text-muted-foreground truncate",title:o.reason,children:o.reason||"No reason provided"})})}),e.jsx(F,{children:e.jsxs("div",{className:`status-badge flex items-center gap-1 px-2 py-1 rounded-full text-xs border w-fit ${b(o.status)}`,children:[L(o.status),e.jsx("span",{className:"capitalize",children:o.status})]})}),e.jsx(F,{children:e.jsx("span",{className:"text-sm text-muted-foreground",children:h(o.created_at)})})]},o.id))})]})})]})]})]})},ct=()=>{const[t,r]=a.useState([]),[s,l]=a.useState(!0),[n,i]=a.useState(null),[m,c]=a.useState(null),[x,f]=a.useState(null),[u,g]=a.useState({isOpen:!1,appointmentId:null}),[d,j]=a.useState(null);a.useEffect(()=>{p()},[]);const p=async()=>{try{const h=localStorage.getItem("token"),y=await fetch("/api/patient-appointments",{headers:{Authorization:`Bearer ${h}`,Accept:"application/json"}});if(!y.ok)throw new Error("Failed to fetch appointments");const o=await y.json();r(o)}catch(h){i(h instanceof Error?h.message:"Failed to load appointments")}finally{l(!1)}},w=async(h,y)=>{c(h);try{const o=localStorage.getItem("token");if(!(await fetch(`/api/appointments/${h}`,{method:"PUT",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({status:y})})).ok)throw new Error("Failed to update appointment");await p()}catch(o){i(o instanceof Error?o.message:"Failed to update appointment")}finally{c(null)}},N=h=>{g({isOpen:!0,appointmentId:h})},S=async()=>{if(u.appointmentId){f(u.appointmentId);try{const h=localStorage.getItem("token"),y=await fetch(`/api/appointments/${u.appointmentId}`,{method:"DELETE",headers:{Authorization:`Bearer ${h}`,Accept:"application/json"}});if(!y.ok){const o=await y.json();throw new Error(o.error||"Failed to delete appointment")}j("Appointment deleted successfully"),await p(),setTimeout(()=>j(null),3e3)}catch(h){i(h instanceof Error?h.message:"Failed to delete appointment")}finally{f(null),g({isOpen:!1,appointmentId:null})}}},D=()=>{g({isOpen:!1,appointmentId:null})},T=h=>{switch(h){case"confirmed":return e.jsx(Z,{className:"h-4 w-4 text-green-600"});case"cancelled":return e.jsx(Te,{className:"h-4 w-4 text-red-600"});default:return e.jsx(Q,{className:"h-4 w-4 text-yellow-600"})}},A=h=>{switch(h){case"confirmed":return"text-green-600 bg-green-50 border-green-200";case"cancelled":return"text-red-600 bg-red-50 border-red-200";default:return"text-yellow-600 bg-yellow-50 border-yellow-200"}},L=h=>new Date(h).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"}),b=h=>new Date(`2000-01-01T${h}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});return s?e.jsxs(O,{children:[e.jsx(H,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-5 w-5"}),"Recent Appointments"]}),e.jsx(ie,{})]})}),e.jsx(U,{children:e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(V,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Loading appointments..."})]})})]}):n?e.jsxs(O,{children:[e.jsx(H,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-5 w-5"}),"Recent Appointments"]}),e.jsx(ie,{})]})}),e.jsx(U,{children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Q,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-red-600 mb-4",children:n}),e.jsx(P,{onClick:p,variant:"outline",children:"Try Again"})]})})]}):e.jsxs(O,{children:[e.jsx(H,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-5 w-5"}),"Recent Appointments"]}),e.jsx(ie,{})]})}),e.jsxs(U,{children:[d&&e.jsx("div",{className:"mb-4 bg-green-50 border border-green-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4 text-green-600"}),e.jsx("p",{className:"text-green-800 text-sm",children:d})]})}),t.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(_,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"No appointments found"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Your upcoming appointments will appear here"})]}):e.jsx("div",{className:"space-y-4",children:t.map(h=>e.jsxs("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium",children:h.doctor})]}),e.jsxs("div",{className:`flex items-center gap-1 px-2 py-1 rounded-full text-xs border ${A(h.status)}`,children:[T(h.status),e.jsx("span",{className:"capitalize",children:h.status})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(_,{className:"h-4 w-4"}),e.jsx("span",{children:L(h.appointment_date)})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(ne,{className:"h-4 w-4"}),e.jsx("span",{children:b(h.appointment_time)})]})]}),h.consultation_type&&e.jsx("div",{className:"mb-3",children:e.jsx("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded",children:h.consultation_type.replace("-"," ")})}),h.reason&&e.jsx("div",{className:"mb-3",children:e.jsx("p",{className:"text-sm text-gray-700 line-clamp-2",children:h.reason})}),e.jsxs("div",{className:"flex items-center gap-2 pt-3 border-t",children:[h.status==="pending"&&e.jsx(P,{size:"sm",variant:"destructive",onClick:()=>w(h.id,"cancelled"),disabled:m===h.id,children:m===h.id?e.jsx(V,{className:"h-3 w-3 animate-spin"}):"Cancel"}),h.status==="cancelled"&&e.jsx(P,{size:"sm",variant:"outline",onClick:()=>N(h.id),disabled:x===h.id,className:"text-red-600 border-red-300 hover:bg-red-50","aria-label":`Delete appointment with ${h.doctor}`,children:x===h.id?e.jsx(V,{className:"h-3 w-3 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(Ae,{className:"h-3 w-3 mr-1"}),"Delete"]})}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500 ml-auto",children:[e.jsx(Ge,{className:"h-3 w-3"}),e.jsx("span",{children:h.phone})]})]})]},h.id))})]}),e.jsx(lt,{isOpen:u.isOpen,onClose:D,onConfirm:S,title:"Delete Appointment",message:"Are you sure you want to permanently delete this appointment? This action cannot be undone.",confirmText:"Delete",cancelText:"Cancel",isLoading:x!==null})]})};function dt(t,r){return a.useReducer((s,l)=>r[s][l]??s,t)}var be="ScrollArea",[Re,Bt]=Ye(be),[mt,R]=Re(be),ke=a.forwardRef((t,r)=>{const{__scopeScrollArea:s,type:l="hover",dir:n,scrollHideDelay:i=600,...m}=t,[c,x]=a.useState(null),[f,u]=a.useState(null),[g,d]=a.useState(null),[j,p]=a.useState(null),[w,N]=a.useState(null),[S,D]=a.useState(0),[T,A]=a.useState(0),[L,b]=a.useState(!1),[h,y]=a.useState(!1),o=G(r,C=>x(C)),v=tt(n);return e.jsx(mt,{scope:s,type:l,dir:v,scrollHideDelay:i,scrollArea:c,viewport:f,onViewportChange:u,content:g,onContentChange:d,scrollbarX:j,onScrollbarXChange:p,scrollbarXEnabled:L,onScrollbarXEnabledChange:b,scrollbarY:w,onScrollbarYChange:N,scrollbarYEnabled:h,onScrollbarYEnabledChange:y,onCornerWidthChange:D,onCornerHeightChange:A,children:e.jsx(ee.div,{dir:v,...m,ref:o,style:{position:"relative","--radix-scroll-area-corner-width":S+"px","--radix-scroll-area-corner-height":T+"px",...t.style}})})});ke.displayName=be;var _e="ScrollAreaViewport",Le=a.forwardRef((t,r)=>{const{__scopeScrollArea:s,children:l,nonce:n,...i}=t,m=R(_e,s),c=a.useRef(null),x=G(r,c,m.onViewportChange);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),e.jsx(ee.div,{"data-radix-scroll-area-viewport":"",...i,ref:x,style:{overflowX:m.scrollbarXEnabled?"scroll":"hidden",overflowY:m.scrollbarYEnabled?"scroll":"hidden",...t.style},children:e.jsx("div",{ref:m.onContentChange,style:{minWidth:"100%",display:"table"},children:l})})]})});Le.displayName=_e;var z="ScrollAreaScrollbar",we=a.forwardRef((t,r)=>{const{forceMount:s,...l}=t,n=R(z,t.__scopeScrollArea),{onScrollbarXEnabledChange:i,onScrollbarYEnabledChange:m}=n,c=t.orientation==="horizontal";return a.useEffect(()=>(c?i(!0):m(!0),()=>{c?i(!1):m(!1)}),[c,i,m]),n.type==="hover"?e.jsx(ht,{...l,ref:r,forceMount:s}):n.type==="scroll"?e.jsx(xt,{...l,ref:r,forceMount:s}):n.type==="auto"?e.jsx(Ie,{...l,ref:r,forceMount:s}):n.type==="always"?e.jsx(ve,{...l,ref:r}):null});we.displayName=z;var ht=a.forwardRef((t,r)=>{const{forceMount:s,...l}=t,n=R(z,t.__scopeScrollArea),[i,m]=a.useState(!1);return a.useEffect(()=>{const c=n.scrollArea;let x=0;if(c){const f=()=>{window.clearTimeout(x),m(!0)},u=()=>{x=window.setTimeout(()=>m(!1),n.scrollHideDelay)};return c.addEventListener("pointerenter",f),c.addEventListener("pointerleave",u),()=>{window.clearTimeout(x),c.removeEventListener("pointerenter",f),c.removeEventListener("pointerleave",u)}}},[n.scrollArea,n.scrollHideDelay]),e.jsx(ae,{present:s||i,children:e.jsx(Ie,{"data-state":i?"visible":"hidden",...l,ref:r})})}),xt=a.forwardRef((t,r)=>{const{forceMount:s,...l}=t,n=R(z,t.__scopeScrollArea),i=t.orientation==="horizontal",m=oe(()=>x("SCROLL_END"),100),[c,x]=dt("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return a.useEffect(()=>{if(c==="idle"){const f=window.setTimeout(()=>x("HIDE"),n.scrollHideDelay);return()=>window.clearTimeout(f)}},[c,n.scrollHideDelay,x]),a.useEffect(()=>{const f=n.viewport,u=i?"scrollLeft":"scrollTop";if(f){let g=f[u];const d=()=>{const j=f[u];g!==j&&(x("SCROLL"),m()),g=j};return f.addEventListener("scroll",d),()=>f.removeEventListener("scroll",d)}},[n.viewport,i,x,m]),e.jsx(ae,{present:s||c!=="hidden",children:e.jsx(ve,{"data-state":c==="hidden"?"hidden":"visible",...l,ref:r,onPointerEnter:W(t.onPointerEnter,()=>x("POINTER_ENTER")),onPointerLeave:W(t.onPointerLeave,()=>x("POINTER_LEAVE"))})})}),Ie=a.forwardRef((t,r)=>{const s=R(z,t.__scopeScrollArea),{forceMount:l,...n}=t,[i,m]=a.useState(!1),c=t.orientation==="horizontal",x=oe(()=>{if(s.viewport){const f=s.viewport.offsetWidth<s.viewport.scrollWidth,u=s.viewport.offsetHeight<s.viewport.scrollHeight;m(c?f:u)}},10);return q(s.viewport,x),q(s.content,x),e.jsx(ae,{present:l||i,children:e.jsx(ve,{"data-state":i?"visible":"hidden",...n,ref:r})})}),ve=a.forwardRef((t,r)=>{const{orientation:s="vertical",...l}=t,n=R(z,t.__scopeScrollArea),i=a.useRef(null),m=a.useRef(0),[c,x]=a.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),f=He(c.viewport,c.content),u={...l,sizes:c,onSizesChange:x,hasThumb:f>0&&f<1,onThumbChange:d=>i.current=d,onThumbPointerUp:()=>m.current=0,onThumbPointerDown:d=>m.current=d};function g(d,j){return bt(d,m.current,c,j)}return s==="horizontal"?e.jsx(ut,{...u,ref:r,onThumbPositionChange:()=>{if(n.viewport&&i.current){const d=n.viewport.scrollLeft,j=Ce(d,c,n.dir);i.current.style.transform=`translate3d(${j}px, 0, 0)`}},onWheelScroll:d=>{n.viewport&&(n.viewport.scrollLeft=d)},onDragScroll:d=>{n.viewport&&(n.viewport.scrollLeft=g(d,n.dir))}}):s==="vertical"?e.jsx(pt,{...u,ref:r,onThumbPositionChange:()=>{if(n.viewport&&i.current){const d=n.viewport.scrollTop,j=Ce(d,c);i.current.style.transform=`translate3d(0, ${j}px, 0)`}},onWheelScroll:d=>{n.viewport&&(n.viewport.scrollTop=d)},onDragScroll:d=>{n.viewport&&(n.viewport.scrollTop=g(d))}}):null}),ut=a.forwardRef((t,r)=>{const{sizes:s,onSizesChange:l,...n}=t,i=R(z,t.__scopeScrollArea),[m,c]=a.useState(),x=a.useRef(null),f=G(r,x,i.onScrollbarXChange);return a.useEffect(()=>{x.current&&c(getComputedStyle(x.current))},[x]),e.jsx(Me,{"data-orientation":"horizontal",...n,ref:f,sizes:s,style:{bottom:0,left:i.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:i.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":le(s)+"px",...t.style},onThumbPointerDown:u=>t.onThumbPointerDown(u.x),onDragScroll:u=>t.onDragScroll(u.x),onWheelScroll:(u,g)=>{if(i.viewport){const d=i.viewport.scrollLeft+u.deltaX;t.onWheelScroll(d),Ue(d,g)&&u.preventDefault()}},onResize:()=>{x.current&&i.viewport&&m&&l({content:i.viewport.scrollWidth,viewport:i.viewport.offsetWidth,scrollbar:{size:x.current.clientWidth,paddingStart:re(m.paddingLeft),paddingEnd:re(m.paddingRight)}})}})}),pt=a.forwardRef((t,r)=>{const{sizes:s,onSizesChange:l,...n}=t,i=R(z,t.__scopeScrollArea),[m,c]=a.useState(),x=a.useRef(null),f=G(r,x,i.onScrollbarYChange);return a.useEffect(()=>{x.current&&c(getComputedStyle(x.current))},[x]),e.jsx(Me,{"data-orientation":"vertical",...n,ref:f,sizes:s,style:{top:0,right:i.dir==="ltr"?0:void 0,left:i.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":le(s)+"px",...t.style},onThumbPointerDown:u=>t.onThumbPointerDown(u.y),onDragScroll:u=>t.onDragScroll(u.y),onWheelScroll:(u,g)=>{if(i.viewport){const d=i.viewport.scrollTop+u.deltaY;t.onWheelScroll(d),Ue(d,g)&&u.preventDefault()}},onResize:()=>{x.current&&i.viewport&&m&&l({content:i.viewport.scrollHeight,viewport:i.viewport.offsetHeight,scrollbar:{size:x.current.clientHeight,paddingStart:re(m.paddingTop),paddingEnd:re(m.paddingBottom)}})}})}),[ft,ze]=Re(z),Me=a.forwardRef((t,r)=>{const{__scopeScrollArea:s,sizes:l,hasThumb:n,onThumbChange:i,onThumbPointerUp:m,onThumbPointerDown:c,onThumbPositionChange:x,onDragScroll:f,onWheelScroll:u,onResize:g,...d}=t,j=R(z,s),[p,w]=a.useState(null),N=G(r,o=>w(o)),S=a.useRef(null),D=a.useRef(""),T=j.viewport,A=l.content-l.viewport,L=$(u),b=$(x),h=oe(g,10);function y(o){if(S.current){const v=o.clientX-S.current.left,C=o.clientY-S.current.top;f({x:v,y:C})}}return a.useEffect(()=>{const o=v=>{const C=v.target;(p==null?void 0:p.contains(C))&&L(v,A)};return document.addEventListener("wheel",o,{passive:!1}),()=>document.removeEventListener("wheel",o,{passive:!1})},[T,p,A,L]),a.useEffect(b,[l,b]),q(p,h),q(j.content,h),e.jsx(ft,{scope:s,scrollbar:p,hasThumb:n,onThumbChange:$(i),onThumbPointerUp:$(m),onThumbPositionChange:b,onThumbPointerDown:$(c),children:e.jsx(ee.div,{...d,ref:N,style:{position:"absolute",...d.style},onPointerDown:W(t.onPointerDown,o=>{o.button===0&&(o.target.setPointerCapture(o.pointerId),S.current=p.getBoundingClientRect(),D.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",j.viewport&&(j.viewport.style.scrollBehavior="auto"),y(o))}),onPointerMove:W(t.onPointerMove,y),onPointerUp:W(t.onPointerUp,o=>{const v=o.target;v.hasPointerCapture(o.pointerId)&&v.releasePointerCapture(o.pointerId),document.body.style.webkitUserSelect=D.current,j.viewport&&(j.viewport.style.scrollBehavior=""),S.current=null})})})}),se="ScrollAreaThumb",Fe=a.forwardRef((t,r)=>{const{forceMount:s,...l}=t,n=ze(se,t.__scopeScrollArea);return e.jsx(ae,{present:s||n.hasThumb,children:e.jsx(gt,{ref:r,...l})})}),gt=a.forwardRef((t,r)=>{const{__scopeScrollArea:s,style:l,...n}=t,i=R(se,s),m=ze(se,s),{onThumbPositionChange:c}=m,x=G(r,g=>m.onThumbChange(g)),f=a.useRef(void 0),u=oe(()=>{f.current&&(f.current(),f.current=void 0)},100);return a.useEffect(()=>{const g=i.viewport;if(g){const d=()=>{if(u(),!f.current){const j=wt(g,c);f.current=j,c()}};return c(),g.addEventListener("scroll",d),()=>g.removeEventListener("scroll",d)}},[i.viewport,u,c]),e.jsx(ee.div,{"data-state":m.hasThumb?"visible":"hidden",...n,ref:x,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...l},onPointerDownCapture:W(t.onPointerDownCapture,g=>{const j=g.target.getBoundingClientRect(),p=g.clientX-j.left,w=g.clientY-j.top;m.onThumbPointerDown({x:p,y:w})}),onPointerUp:W(t.onPointerUp,m.onThumbPointerUp)})});Fe.displayName=se;var Ne="ScrollAreaCorner",Oe=a.forwardRef((t,r)=>{const s=R(Ne,t.__scopeScrollArea),l=!!(s.scrollbarX&&s.scrollbarY);return s.type!=="scroll"&&l?e.jsx(jt,{...t,ref:r}):null});Oe.displayName=Ne;var jt=a.forwardRef((t,r)=>{const{__scopeScrollArea:s,...l}=t,n=R(Ne,s),[i,m]=a.useState(0),[c,x]=a.useState(0),f=!!(i&&c);return q(n.scrollbarX,()=>{var g;const u=((g=n.scrollbarX)==null?void 0:g.offsetHeight)||0;n.onCornerHeightChange(u),x(u)}),q(n.scrollbarY,()=>{var g;const u=((g=n.scrollbarY)==null?void 0:g.offsetWidth)||0;n.onCornerWidthChange(u),m(u)}),f?e.jsx(ee.div,{...l,ref:r,style:{width:i,height:c,position:"absolute",right:n.dir==="ltr"?0:void 0,left:n.dir==="rtl"?0:void 0,bottom:0,...t.style}}):null});function re(t){return t?parseInt(t,10):0}function He(t,r){const s=t/r;return isNaN(s)?0:s}function le(t){const r=He(t.viewport,t.content),s=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,l=(t.scrollbar.size-s)*r;return Math.max(l,18)}function bt(t,r,s,l="ltr"){const n=le(s),i=n/2,m=r||i,c=n-m,x=s.scrollbar.paddingStart+m,f=s.scrollbar.size-s.scrollbar.paddingEnd-c,u=s.content-s.viewport,g=l==="ltr"?[0,u]:[u*-1,0];return Be([x,f],g)(t)}function Ce(t,r,s="ltr"){const l=le(r),n=r.scrollbar.paddingStart+r.scrollbar.paddingEnd,i=r.scrollbar.size-n,m=r.content-r.viewport,c=i-l,x=s==="ltr"?[0,m]:[m*-1,0],f=st(t,x);return Be([0,m],[0,c])(f)}function Be(t,r){return s=>{if(t[0]===t[1]||r[0]===r[1])return r[0];const l=(r[1]-r[0])/(t[1]-t[0]);return r[0]+l*(s-t[0])}}function Ue(t,r){return t>0&&t<r}var wt=(t,r=()=>{})=>{let s={left:t.scrollLeft,top:t.scrollTop},l=0;return function n(){const i={left:t.scrollLeft,top:t.scrollTop},m=s.left!==i.left,c=s.top!==i.top;(m||c)&&r(),s=i,l=window.requestAnimationFrame(n)}(),()=>window.cancelAnimationFrame(l)};function oe(t,r){const s=$(t),l=a.useRef(0);return a.useEffect(()=>()=>window.clearTimeout(l.current),[]),a.useCallback(()=>{window.clearTimeout(l.current),l.current=window.setTimeout(s,r)},[s,r])}function q(t,r){const s=$(r);Xe(()=>{let l=0;if(t){const n=new ResizeObserver(()=>{cancelAnimationFrame(l),l=window.requestAnimationFrame(s)});return n.observe(t),()=>{window.cancelAnimationFrame(l),n.unobserve(t)}}},[t,s])}var $e=ke,vt=Le,Nt=Oe;const ye=a.forwardRef(({className:t,children:r,...s},l)=>e.jsxs($e,{ref:l,className:I("relative overflow-hidden",t),...s,children:[e.jsx(vt,{className:"h-full w-full rounded-[inherit]",children:r}),e.jsx(We,{}),e.jsx(Nt,{})]}));ye.displayName=$e.displayName;const We=a.forwardRef(({className:t,orientation:r="vertical",...s},l)=>e.jsx(we,{ref:l,orientation:r,className:I("flex touch-none select-none transition-colors",r==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",r==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...s,children:e.jsx(Fe,{className:"relative flex-1 rounded-full bg-border"})}));We.displayName=we.displayName;const yt=()=>{const[t,r]=a.useState([]),[s,l]=a.useState(!0),[n,i]=a.useState(null),[m,c]=a.useState(!1);a.useEffect(()=>{x()},[]);const x=async()=>{try{const p=localStorage.getItem("token");if(!p){i("Authentication required"),l(!1);return}const w=await fetch("/api/patient/prescriptions",{headers:{Authorization:`Bearer ${p}`,Accept:"application/json"}});if(!w.ok)throw new Error("Failed to fetch prescriptions");const N=await w.json();r(N)}catch(p){i(p instanceof Error?p.message:"Failed to load prescriptions")}finally{l(!1)}},f=p=>new Date(p).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),u=p=>{const w=p.is_expired??(p.end_date&&new Date(p.end_date)<new Date),N=p.is_currently_active??(p.is_active&&!w);return w?e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-red-100 text-red-800",children:"Expired"}):N?e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-green-100 text-green-800",children:"Active"}):e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-yellow-100 text-yellow-800",children:"Inactive"})};if(s)return e.jsxs(O,{children:[e.jsx(H,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5"}),"My Prescriptions"]})}),e.jsx(U,{children:e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(V,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Loading prescriptions..."})]})})]});if(n)return e.jsxs(O,{children:[e.jsx(H,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5"}),"My Prescriptions"]})}),e.jsx(U,{children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Q,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-red-600 mb-4",children:n})]})})]});const g=t[0],d=t.length>1,j=({prescription:p,isLatest:w=!1})=>e.jsxs("div",{className:`border rounded-lg p-4 hover:shadow-md transition-all duration-200 bg-white ${w?"ring-2 ring-blue-100":""}`,children:[w&&d&&e.jsx("div",{className:"mb-2",children:e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800 font-medium",children:"Most Recent"})}),e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg text-gray-900",children:p.medication_name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[p.dosage," â€¢ ",p.frequency]})]}),u(p)]}),p.instructions&&e.jsx("div",{className:"mb-3",children:e.jsxs("p",{className:"text-sm text-gray-700 bg-blue-50 p-3 rounded border-l-4 border-blue-200",children:[e.jsx("strong",{children:"Instructions:"})," ",p.instructions]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-4 w-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Start Date:"}),e.jsx("p",{className:"font-medium",children:f(p.start_date)})]})]}),p.end_date&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"End Date:"}),e.jsx("p",{className:"font-medium",children:f(p.end_date)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Refills:"}),e.jsxs("p",{className:"font-medium",children:[p.refills_remaining," remaining"]})]})]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx(he,{className:"h-3 w-3"}),e.jsxs("span",{children:["Prescribed on ",f(p.created_at)]})]})})]});return e.jsxs(O,{children:[e.jsx(H,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5"}),"My Prescriptions"]})}),e.jsx(U,{children:t.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(X,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 mb-2",children:"No prescriptions found"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Your prescription history will appear here"})]}):e.jsxs(e.Fragment,{children:[e.jsx(j,{prescription:g,isLatest:!0}),d&&e.jsx("div",{className:"mt-4 text-center",children:e.jsxs(xe,{open:m,onOpenChange:c,children:[e.jsx(ue,{asChild:!0,children:e.jsxs(P,{variant:"outline",className:"hover:bg-blue-50 hover:border-blue-300 transition-colors duration-300","aria-label":`View all ${t.length} prescriptions`,children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"View All (",t.length,")"]})}),e.jsxs(pe,{className:"max-w-[90vw] md:max-w-[60vw] max-h-[90vh] transition-all duration-300 ease-in-out","aria-labelledby":"prescriptions-modal-title","aria-describedby":"prescriptions-modal-description",children:[e.jsx(fe,{children:e.jsxs(ge,{id:"prescriptions-modal-title",className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5"}),"All Prescriptions (",t.length,")"]})}),e.jsx("div",{id:"prescriptions-modal-description",className:"sr-only",children:"Complete list of all your prescriptions with details"}),e.jsx(ye,{className:"h-[70vh] pr-4",children:e.jsx("div",{className:"space-y-4",children:t.map(p=>e.jsx(j,{prescription:p},p.id))})})]})]})})]})})]})},St=({triggerButton:t})=>{const{user:r}=me(),[s,l]=a.useState([]),[n,i]=a.useState(!1),[m,c]=a.useState(""),[x,f]=a.useState(!1),[u,g]=a.useState(null),[d,j]=a.useState(null),[p,w]=a.useState(""),N=a.useCallback(async()=>{if(!r||r.role!=="patient"){c("Invalid patient access");return}if(!r.patient_id){c("Invalid patient ID");return}i(!0),c("");try{const h=localStorage.getItem("token");if(!h)throw new Error("Authentication required");const y=await fetch("/api/patient-medical-records",{headers:{Authorization:`Bearer ${h}`,"Content-Type":"application/json"}});if(y.ok){const o=await y.json();l(o||[])}else if(y.status===404)l([]);else throw new Error(`Failed to load records (${y.status})`)}catch(h){const y=h instanceof Error?h.message:"Failed to load medical records";c(y),l([])}finally{i(!1)}},[r]);a.useEffect(()=>{x&&(N(),w(""))},[x,N]);const S=b=>{switch(b.toLowerCase()){case"complete":return e.jsx(Z,{className:"h-4 w-4 text-green-600"});case"reviewed":return e.jsx(je,{className:"h-4 w-4 text-blue-600"});default:return e.jsx(ne,{className:"h-4 w-4 text-yellow-600"})}},D=b=>{switch(b.toLowerCase()){case"complete":return"bg-green-100 text-green-800";case"reviewed":return"bg-blue-100 text-blue-800";default:return"bg-yellow-100 text-yellow-800"}},T=b=>new Date(b).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),A=async b=>{var h;g(b),c(""),w("");try{const y=localStorage.getItem("token");if(!y)throw new Error("Authentication token not found. Please log in again.");const o=await fetch(`/api/medical-records/${b}`,{method:"DELETE",headers:{Authorization:`Bearer ${y}`,"Content-Type":"application/json"}});if(o.ok){const v=(h=s.find(C=>C.id===b))==null?void 0:h.title;l(C=>C.filter(E=>E.id!==b)),j(null),w(`Record "${v}" has been deleted successfully.`),setTimeout(()=>w(""),3e3)}else{let v="Failed to delete record";throw o.status===401?v="Authentication expired. Please log in again.":o.status===403?v="You do not have permission to delete this record.":o.status===404&&(v="Record not found. It may have already been deleted."),new Error(v)}}catch(y){const o=y instanceof Error?y.message:"An unexpected error occurred while deleting the record.";console.error("[Delete] Error:",o,y),c(o)}finally{g(null)}},L=e.jsxs(P,{size:"sm",variant:"outline",className:"border-border",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"View All Medical Records"]});return e.jsxs(xe,{open:x,onOpenChange:f,children:[e.jsx(ue,{asChild:!0,children:t||L}),e.jsxs(pe,{className:"max-w-4xl max-h-[85vh]","aria-labelledby":"medical-records-title","aria-describedby":"medical-records-description",children:[e.jsx(fe,{children:e.jsxs(ge,{id:"medical-records-title",className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5 text-primary"}),"All Medical Records",r&&r.role==="patient"&&e.jsxs(te,{variant:"outline",className:"ml-2",children:["Patient ID: ",r.patient_id]})]})}),e.jsx("div",{id:"medical-records-description",className:"sr-only",children:"Complete list of medical records for the current patient"}),p&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3 mb-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-green-800",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:p})]})}),e.jsx(ye,{className:"h-[60vh] pr-4",children:n?e.jsxs("div",{className:"flex items-center justify-center py-8 text-muted-foreground",children:[e.jsx(V,{className:"h-6 w-6 animate-spin mr-2"}),e.jsx("div",{children:"Loading medical records..."})]}):m?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ce,{className:"h-8 w-8 text-red-600 mx-auto mb-4"}),e.jsx("div",{className:"text-red-600 mb-4",children:m}),e.jsx(P,{onClick:N,variant:"outline",size:"sm",children:"Try Again"})]}):s.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(X,{className:"h-8 w-8 mx-auto mb-4 opacity-50"}),e.jsx("div",{children:"No medical records found for this patient"})]}):e.jsx("div",{className:"space-y-4",children:s.map(b=>e.jsxs("div",{className:"border border-border rounded-lg p-4 bg-card hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[b.critical_flag&&e.jsx(ce,{className:"h-5 w-5 text-red-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-foreground text-lg",children:b.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(te,{variant:"secondary",className:"text-xs",children:b.record_type}),e.jsx(te,{className:`text-xs ${D(b.status)}`,children:e.jsxs("span",{className:"flex items-center gap-1",children:[S(b.status),b.status]})}),b.critical_flag&&e.jsx(te,{variant:"destructive",className:"text-xs",children:"Critical"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(_,{className:"h-4 w-4"}),T(b.record_date)]}),e.jsx("div",{className:"flex items-center gap-2",children:d===b.id?e.jsxs("div",{className:"flex gap-1",children:[e.jsx(P,{size:"sm",variant:"destructive",onClick:()=>A(b.id),disabled:u===b.id,className:"h-8 px-2","aria-label":"Confirm delete",children:u===b.id?e.jsx(V,{className:"h-3 w-3 animate-spin"}):"Confirm"}),e.jsx(P,{size:"sm",variant:"outline",onClick:()=>j(null),className:"h-8 px-2","aria-label":"Cancel delete",children:"Cancel"})]}):e.jsxs(P,{size:"sm",variant:"destructive",onClick:()=>j(b.id),disabled:u===b.id,className:"h-8 px-2","aria-label":`Delete record: ${b.title}`,title:"Delete this medical record permanently",children:[e.jsx(Ae,{className:"h-3 w-3 mr-1"}),"Delete"]})})]})]}),b.description&&e.jsx("p",{className:"text-sm text-muted-foreground mb-2 leading-relaxed",children:b.description}),b.doctor_name&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Doctor: ",b.doctor_name]})]},b.id))})}),s.length>0&&e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t border-border text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Total Records: ",s.length]}),e.jsxs("span",{children:["Last Updated: ",new Date().toLocaleString()]})]})]})]})},Ut=()=>{const{user:t}=me(),[r,s]=a.useState([]),[l,n]=a.useState([]),[i,m]=a.useState([]),[c,x]=a.useState(!0);a.useEffect(()=>{const d=async()=>{try{const w=localStorage.getItem("token"),N=await fetch("/api/patient-appointments",{headers:{Authorization:`Bearer ${w}`,"Content-Type":"application/json"}});if(N.ok){const S=await N.json();s(S)}else s([])}catch(w){console.error("Error fetching appointments:",w)}},j=async()=>{try{const w=localStorage.getItem("token");if(!w){console.error("No authentication token found"),n([]);return}const N=await fetch("/api/patient/prescriptions",{headers:{Authorization:`Bearer ${w}`,"Content-Type":"application/json"}});if(N.ok){const S=await N.json();n(S)}else console.error("Failed to fetch prescriptions:",N.status,N.statusText),n([])}catch(w){console.error("Error fetching prescriptions:",w),n([])}finally{x(!1)}},p=async()=>{try{const w=localStorage.getItem("token");if(!w){console.error("No authentication token found"),m([]);return}const N=await fetch("/api/patient-medical-records",{headers:{Authorization:`Bearer ${w}`,"Content-Type":"application/json"}});if(N.ok){const S=await N.json();m(S)}else console.error("Failed to fetch medical records:",N.status,N.statusText),m([])}catch(w){console.error("Error fetching medical records:",w),m([])}};t!=null&&t.email&&(d(),j(),p())},[t==null?void 0:t.email]);const f=r.filter(d=>new Date(d.appointment_date)>=new Date),u=l.filter(d=>{const j=!d.end_date||new Date(d.end_date)>=new Date;return d.is_active&&j}),g=[{icon:_,label:"Upcoming Appointments",value:f.length.toString(),color:"text-primary"},{icon:Y,label:"Active Prescriptions",value:u.length.toString(),color:"text-primary"},{icon:X,label:"Medical Records",value:i.length.toString(),color:"text-primary"}];return e.jsxs(e.Fragment,{children:[e.jsxs(qe,{children:[e.jsx("title",{children:"Patient Dashboard - Healthcare Portal"}),e.jsx("meta",{name:"description",content:"Manage your healthcare appointments and records"})]}),e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(Ke,{}),e.jsx("main",{className:"pt-24 px-4 py-8",children:e.jsxs("div",{className:"container mx-auto max-w-6xl",children:[e.jsxs("div",{className:"mb-12 animate-fade-in-up",children:[e.jsxs("h1",{className:"text-4xl md:text-5xl font-display font-bold text-gradient mb-4",children:["Welcome, ",t==null?void 0:t.name,"!"]}),e.jsx("p",{className:"text-xl text-muted-foreground",children:"Here's your health dashboard overview"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12",children:g.map((d,j)=>e.jsxs(O,{className:"shadow-card border-border bg-card hover:shadow-elegant transition-smooth animate-fade-in-up",style:{animationDelay:`${j*.1}s`},children:[e.jsxs(H,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium text-foreground",children:d.label}),e.jsx(d.icon,{className:`h-5 w-5 ${d.color}`})]}),e.jsx(U,{children:e.jsx("div",{className:"text-3xl font-bold text-foreground",children:d.value})})]},j))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsx("div",{className:"animate-fade-in-up",style:{animationDelay:"0.5s"},children:e.jsx(ct,{})}),e.jsx("div",{className:"animate-fade-in-up",style:{animationDelay:"0.6s"},children:e.jsx(yt,{})})]}),e.jsx("div",{className:"mt-12",children:e.jsxs(O,{className:"shadow-card border-border bg-card animate-fade-in-up",style:{animationDelay:"0.8s"},children:[e.jsxs(H,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(B,{className:"text-foreground flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5 text-primary"}),"Medical Records"]}),e.jsx(Je,{className:"text-muted-foreground",children:"Your recent medical records and test results"})]}),e.jsx(St,{})]}),e.jsx(U,{children:e.jsx("div",{className:"space-y-4",children:c?e.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"Loading medical records..."}):i.length>0?i.slice(0,3).map(d=>e.jsx("div",{className:"flex justify-between items-start p-4 border border-border rounded-lg bg-muted/50 hover:bg-muted transition-smooth",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-2 h-2 rounded-full mt-2 ${d.status==="complete"?"bg-green-500":d.status==="reviewed"?"bg-blue-500":"bg-yellow-500"}`}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-foreground",children:d.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:d.record_type}),d.description&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:d.description}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:new Date(d.record_date).toLocaleDateString()}),e.jsx("p",{className:"text-xs text-primary mt-1 capitalize",children:d.status})]})]})},d.id)):e.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"No medical records available"})})})]})})]})}),e.jsx(Qe,{})]})]})};export{Ut as default};
