import{c as ce,r as l,j as e,B as d,X as E}from"./app-BPDUEK9a.js";import{H as de}from"./Helmet-BiIo1ML3.js";import{C as oe,b as me,c as ue,d as he,a as xe}from"./card-BqqNk-QP.js";import{I as p}from"./input-AcdKypGh.js";import{L as c}from"./label-P2TIaloK.js";import{T as S}from"./textarea-CzHXQi5q.js";import{S as C,a as k,b as P,c as T,d as m}from"./select-CJoQfoST.js";import{N as ge,C as je,F as fe}from"./Footer-wJw2Vl0P.js";import{D as pe,C as ve}from"./DoctorSidebar-CEaQMqzr.js";import{P as q}from"./plus-Bsl0et-N.js";import{S as Ne}from"./search-DvyyjPPN.js";import{P as be}from"./pill-kuU3DUwh.js";import{S as ye}from"./square-pen-blEYN18v.js";import{T as _e}from"./trash-2-D3-tCuKP.js";import{C as we}from"./chevron-left-BX7RbOHl.js";import"./index-BdQq_4o_.js";import"./index-ChckW8YR.js";import"./Combination-ChCfGbNx.js";import"./index-uz5DySL3.js";import"./chevron-down-C8yMOnh6.js";import"./users-D4XgOMwN.js";import"./clock-BSsGIyad.js";import"./stethoscope-BLRoqvLi.js";import"./file-text-I48TLzjZ.js";import"./message-square-D0_nukOK.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=ce("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),Qe=()=>{const[L,J]=l.useState([]),[M,W]=l.useState([]),[X,D]=l.useState(!1),[v,B]=l.useState(null),[_,w]=l.useState(!1),[O,o]=l.useState(""),[R,g]=l.useState(""),[N,K]=l.useState(""),[y,Q]=l.useState("all"),[h,$]=l.useState(1),[F,Y]=l.useState(1),[j,I]=l.useState([]),[n,u]=l.useState({patient_id:"",instructions:"",is_active:!0,medicines:[{medicine_name:"",dosage:"",frequency:"",start_date:"",end_date:"",refills_remaining:"",instructions:""}],tests:[{test_name:"",description:"",instructions:""}]}),x=l.useCallback(async(s=1)=>{try{w(!0);const t=localStorage.getItem("token"),a=new URLSearchParams({page:s.toString(),per_page:"10",...N&&{search:N},...y!=="all"&&{status:y}}),r=await fetch(`/api/prescriptions?${a}`,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(r.ok){const i=await r.json();J(i.data||i),$(i.current_page||1),Y(i.last_page||1)}}catch(t){console.error("Error fetching prescriptions:",t),o("Failed to fetch prescriptions")}finally{w(!1)}},[N,y]),V=l.useCallback(()=>{$(1),x(1)},[x]);l.useEffect(()=>{x(),Z()},[x]),l.useEffect(()=>{const s=setTimeout(()=>{N!==void 0&&V()},500);return()=>clearTimeout(s)},[N,y,V]);const Z=async()=>{try{const s=localStorage.getItem("token"),t=await fetch("/api/patients-and-guests",{headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}});if(t.ok){const a=await t.json();console.log("Fetched patients and guests:",a),W(a)}else console.error("Failed to fetch patients and guests:",t.status,t.statusText)}catch(s){console.error("Error fetching patients and guests:",s)}},ee=()=>{u({...n,medicines:[...n.medicines,{medicine_name:"",dosage:"",frequency:"",start_date:"",end_date:"",refills_remaining:"",instructions:""}]})},se=s=>{n.medicines.length>1&&u({...n,medicines:n.medicines.filter((t,a)=>a!==s)})},f=(s,t,a)=>{const r=[...n.medicines];r[s][t]=a,u({...n,medicines:r})},te=()=>{u({...n,tests:[...n.tests,{test_name:"",description:"",instructions:""}]})},ae=s=>{n.tests.length>1&&u({...n,tests:n.tests.filter((t,a)=>a!==s)})},A=(s,t,a)=>{const r=[...n.tests];r[s][t]=a,u({...n,tests:r})},ie=async s=>{if(s.preventDefault(),o(""),!n.patient_id){o("Please select a patient");return}const t=n.medicines.filter(r=>r.medicine_name&&r.dosage&&r.frequency&&r.start_date),a=n.tests.filter(r=>r.test_name);if(t.length===0&&a.length===0){o("Please add at least one medicine or test");return}w(!0);try{const r=localStorage.getItem("token"),i=v?`/api/prescriptions/${v}`:"/api/prescriptions",H=await fetch(i,{method:v?"PUT":"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify({...n,medicines:t.length>0?t:void 0,tests:a.length>0?a:void 0})});if(H.ok)await x(h),G(),g(v?"Prescription updated successfully!":"Prescription added successfully!"),setTimeout(()=>g(""),3e3);else{const le=await H.json().catch(()=>({message:"Unknown error occurred"}));o(le.message||"Failed to save prescription")}}catch(r){o("Network error: "+r.message)}finally{w(!1)}},G=()=>{u({patient_id:"",instructions:"",is_active:!0,medicines:[{medicine_name:"",dosage:"",frequency:"",start_date:"",end_date:"",refills_remaining:"",instructions:""}],tests:[{test_name:"",description:"",instructions:""}]}),D(!1),B(null),o(""),g("")},ne=s=>{var a,r;const t=s.patient_id?s.patient_id.toString():`guest_${s.guest_id}`;u({patient_id:t,instructions:s.instructions||"",is_active:s.is_active,medicines:((a=s.medicines)==null?void 0:a.length)>0?s.medicines:[{medicine_name:"",dosage:"",frequency:"",start_date:"",end_date:"",refills_remaining:"",instructions:""}],tests:((r=s.tests)==null?void 0:r.length)>0?s.tests:[{test_name:"",description:"",instructions:""}]}),B(s.id),D(!0)},re=async s=>{if(confirm("Are you sure you want to delete this prescription?"))try{const t=localStorage.getItem("token");(await fetch(`/api/prescriptions/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}})).ok?(await x(h),g("Prescription deleted successfully!"),setTimeout(()=>g(""),3e3)):o("Failed to delete prescription")}catch(t){o("Network error: "+t.message)}},z=async s=>{if(j.length===0){o("Please select prescriptions first");return}if(confirm(`Are you sure you want to ${s} selected prescriptions?`))try{const t=localStorage.getItem("token");(await fetch("/api/prescriptions/bulk-update",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({prescription_ids:j,action:s})})).ok?(await x(h),I([]),g(`Prescriptions ${s}d successfully!`),setTimeout(()=>g(""),3e3)):o(`Failed to ${s} prescriptions`)}catch(t){o("Network error: "+t.message)}},U=s=>{$(s),x(s)};return e.jsxs(e.Fragment,{children:[e.jsx(de,{children:e.jsx("title",{children:"Prescriptions - Doctor Dashboard"})}),e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(ge,{}),e.jsxs("div",{className:"flex pt-20",children:[e.jsx(pe,{}),e.jsx("main",{className:"flex-1 px-6 py-8",children:e.jsxs("div",{className:"container mx-auto max-w-6xl",children:[e.jsxs("div",{className:"mb-8 animate-fade-in-up",children:[e.jsx("h1",{className:"text-4xl font-display font-bold text-gradient mb-4",children:"Prescriptions"}),e.jsx("p",{className:"text-xl text-muted-foreground",children:"Manage patient prescriptions and medications"})]}),e.jsxs(oe,{className:"shadow-card border-border bg-card",children:[e.jsxs(me,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(ue,{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-5 w-5 text-primary"}),"Prescriptions Management"]}),e.jsx(he,{children:"View and manage patient medications"})]}),e.jsxs(d,{onClick:()=>D(!0),className:"gradient-primary shadow-elegant",children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Add Prescription"]})]}),e.jsxs(xe,{children:[e.jsxs("div",{className:"mb-6 flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Ne,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(p,{placeholder:"Search by medication or patient name...",value:N,onChange:s=>K(s.target.value),className:"pl-10"})]}),e.jsxs(C,{value:y,onValueChange:Q,children:[e.jsxs(k,{className:"w-full sm:w-48",children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),e.jsx(P,{})]}),e.jsxs(T,{children:[e.jsx(m,{value:"all",children:"All Status"}),e.jsx(m,{value:"active",children:"Active Only"}),e.jsx(m,{value:"inactive",children:"Inactive Only"})]})]})]}),j.length>0&&e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-blue-700",children:[j.length," prescription(s) selected"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{size:"sm",variant:"outline",onClick:()=>z("activate"),children:"Activate"}),e.jsx(d,{size:"sm",variant:"outline",onClick:()=>z("deactivate"),children:"Deactivate"}),e.jsx(d,{size:"sm",variant:"destructive",onClick:()=>z("delete"),children:"Delete"})]})]}),X&&e.jsxs("form",{onSubmit:ie,className:"mb-6 p-4 border border-border rounded-lg bg-muted/30",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:v?"Edit Prescription":"New Prescription"}),e.jsx(d,{type:"button",onClick:G,variant:"ghost",size:"sm",children:e.jsx(E,{className:"h-4 w-4"})})]}),O&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md text-red-700 text-sm",children:O}),R&&e.jsx("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-md text-green-700 text-sm",children:R}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{children:"Patient *"}),e.jsxs(C,{value:n.patient_id,onValueChange:s=>u({...n,patient_id:s}),children:[e.jsx(k,{children:e.jsx(P,{placeholder:"Select patient"})}),e.jsx(T,{children:M.map(s=>e.jsx(m,{value:s.id.toString(),children:s.display_name},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Status"}),e.jsxs(C,{value:n.is_active.toString(),onValueChange:s=>u({...n,is_active:s==="true"}),children:[e.jsx(k,{children:e.jsx(P,{})}),e.jsxs(T,{children:[e.jsx(m,{value:"true",children:"Active"}),e.jsx(m,{value:"false",children:"Inactive"})]})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(c,{children:"General Instructions"}),e.jsx(S,{value:n.instructions,onChange:s=>u({...n,instructions:s.target.value}),placeholder:"General instructions for the patient"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx(c,{className:"text-lg font-semibold",children:"Medicines"}),e.jsxs(d,{type:"button",onClick:ee,variant:"outline",size:"sm",children:[e.jsx(q,{className:"h-4 w-4 mr-1"}),"Add Medicine"]})]}),n.medicines.map((s,t)=>e.jsxs("div",{className:"border border-border rounded-lg p-4 mb-3 bg-muted/30",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("h4",{className:"font-medium",children:["Medicine ",t+1]}),n.medicines.length>1&&e.jsx(d,{type:"button",onClick:()=>se(t),variant:"destructive",size:"sm",children:e.jsx(E,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx(c,{children:"Medicine Name *"}),e.jsx(p,{value:s.medicine_name,onChange:a=>f(t,"medicine_name",a.target.value),placeholder:"Medicine name"})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Dosage *"}),e.jsx(p,{value:s.dosage,onChange:a=>f(t,"dosage",a.target.value),placeholder:"e.g., 100mg"})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Frequency *"}),e.jsxs(C,{value:s.frequency,onValueChange:a=>f(t,"frequency",a),children:[e.jsx(k,{children:e.jsx(P,{placeholder:"Select frequency"})}),e.jsxs(T,{children:[e.jsx(m,{value:"Once daily",children:"Once daily"}),e.jsx(m,{value:"Twice daily",children:"Twice daily"}),e.jsx(m,{value:"Three times daily",children:"Three times daily"}),e.jsx(m,{value:"Four times daily",children:"Four times daily"}),e.jsx(m,{value:"As needed",children:"As needed"}),e.jsx(m,{value:"Weekly",children:"Weekly"})]})]})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Start Date *"}),e.jsx(p,{type:"date",value:s.start_date,onChange:a=>f(t,"start_date",a.target.value)})]}),e.jsxs("div",{children:[e.jsx(c,{children:"End Date"}),e.jsx(p,{type:"date",value:s.end_date,onChange:a=>f(t,"end_date",a.target.value),min:s.start_date})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Refills Remaining"}),e.jsx(p,{type:"number",min:"0",value:s.refills_remaining,onChange:a=>f(t,"refills_remaining",a.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"col-span-3",children:[e.jsx(c,{children:"Instructions"}),e.jsx(S,{value:s.instructions,onChange:a=>f(t,"instructions",a.target.value),placeholder:"Specific instructions for this medicine",rows:2})]})]})]},t))]}),e.jsxs("div",{className:"col-span-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx(c,{className:"text-lg font-semibold",children:"Tests"}),e.jsxs(d,{type:"button",onClick:te,variant:"outline",size:"sm",children:[e.jsx(q,{className:"h-4 w-4 mr-1"}),"Add Test"]})]}),n.tests.map((s,t)=>e.jsxs("div",{className:"border border-border rounded-lg p-4 mb-3 bg-muted/30",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("h4",{className:"font-medium",children:["Test ",t+1]}),n.tests.length>1&&e.jsx(d,{type:"button",onClick:()=>ae(t),variant:"destructive",size:"sm",children:e.jsx(E,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{children:[e.jsx(c,{children:"Test Name *"}),e.jsx(p,{value:s.test_name,onChange:a=>A(t,"test_name",a.target.value),placeholder:"Test name"})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Description"}),e.jsx(S,{value:s.description,onChange:a=>A(t,"description",a.target.value),placeholder:"Test description",rows:2})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Instructions"}),e.jsx(S,{value:s.instructions,onChange:a=>A(t,"instructions",a.target.value),placeholder:"Specific instructions for this test",rows:2})]})]})]},t))]}),e.jsx("div",{className:"col-span-2",children:e.jsx(d,{type:"submit",className:"w-full",disabled:_,children:_?"Saving...":v?"Update Prescription":"Add Prescription"})})]})]}),e.jsxs("div",{className:"space-y-4",children:[_?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Loading prescriptions..."}):L.map(s=>{const t=M.find(i=>s.patient_id&&i.id===s.patient_id||s.guest_id&&i.id===`guest_${s.guest_id}`),a=s.start_date?new Date(s.start_date).toLocaleDateString():null,r=s.end_date?new Date(s.end_date).toLocaleDateString():null;return e.jsxs("div",{className:"flex justify-between items-start p-4 border border-border rounded-lg bg-muted/50 hover:bg-muted transition-smooth",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:j.includes(s.id),onChange:i=>{i.target.checked?I([...j,s.id]):I(j.filter(b=>b!==s.id))},className:"mr-2","aria-label":`Select prescription for ${t?t.display_name:s.patient_id?`Patient ID: ${s.patient_id}`:`Guest ID: ${s.guest_id}`}`}),e.jsx(be,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-foreground",children:t?t.display_name:s.patient_id?`Patient ID: ${s.patient_id}`:`Guest ID: ${s.guest_id}`}),s.medication_name&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-primary font-medium",children:s.medication_name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Dosage: ",s.dosage," | Frequency: ",s.frequency]})]}),s.medicines&&s.medicines.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm font-medium text-primary",children:"Medicines:"}),s.medicines.map((i,b)=>e.jsxs("div",{className:"ml-2 mt-1",children:[e.jsx("p",{className:"text-sm font-medium",children:i.medicine_name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[i.dosage," | ",i.frequency,i.start_date&&` | Start: ${new Date(i.start_date).toLocaleDateString()}`,i.end_date&&` | End: ${new Date(i.end_date).toLocaleDateString()}`,i.refills_remaining&&` | Refills: ${i.refills_remaining}`]}),i.instructions&&e.jsx("p",{className:"text-xs text-muted-foreground italic",children:i.instructions})]},b))]}),s.tests&&s.tests.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm font-medium text-primary",children:"Tests:"}),s.tests.map((i,b)=>e.jsxs("div",{className:"ml-2 mt-1",children:[e.jsx("p",{className:"text-sm font-medium",children:i.test_name}),i.description&&e.jsx("p",{className:"text-xs text-muted-foreground",children:i.description}),i.instructions&&e.jsx("p",{className:"text-xs text-muted-foreground italic",children:i.instructions})]},b))]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Start: ",a,r?` | End: ${r}`:""]}),s.refills_remaining&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Refills: ",s.refills_remaining]}),s.instructions&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1 italic",children:s.instructions}),e.jsx("p",{className:`text-xs mt-1 ${s.is_active?"text-green-600":"text-red-600"}`,children:s.is_active?"Active":"Inactive"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{size:"sm",variant:"outline",onClick:()=>ne(s),children:e.jsx(ye,{className:"h-4 w-4"})}),e.jsx(d,{size:"sm",variant:"destructive",onClick:()=>re(s.id),children:e.jsx(_e,{className:"h-4 w-4"})})]})]},s.id)}),!_&&L.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No prescriptions found."})]}),F>1&&e.jsxs("div",{className:"flex items-center justify-between mt-6",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Page ",h," of ",F]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{size:"sm",variant:"outline",onClick:()=>U(h-1),disabled:h===1,children:e.jsx(we,{className:"h-4 w-4"})}),e.jsx(d,{size:"sm",variant:"outline",onClick:()=>U(h+1),disabled:h===F,children:e.jsx(je,{className:"h-4 w-4"})})]})]})]})]})]})})]}),e.jsx(fe,{})]})]})};export{Qe as default};
