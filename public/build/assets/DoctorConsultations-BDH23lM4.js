import{r as n,j as e,B as m,X as D}from"./app-CA97xQT9.js";import{H as k}from"./Helmet-VFA4f7Dq.js";import{C as I,b as T,c as E,d as F,a as P}from"./card-gaL2e-uj.js";import{I as u}from"./input-B3Ct7k3H.js";import{L as l}from"./label-D6qvg7bS.js";import{T as A}from"./textarea-C_r1I8D2.js";import{S as L,a as $,b as z,c as B,d as q}from"./select-DRVG8Pjv.js";import{N as H,F as R}from"./Footer-rh8Alvxn.js";import{D as U}from"./DoctorSidebar-CdQqX0aC.js";import{S as V}from"./stethoscope-o9s58rJw.js";import{P as M}from"./plus-D6IRAj0N.js";import{T as O}from"./trash-2-Y0-pyl7E.js";import"./index-BdQq_4o_.js";import"./index-BgJJ74YJ.js";import"./Combination-DVZWF5pO.js";import"./index-DTSB0etq.js";import"./chevron-down-BhQJAaf2.js";import"./users-BRuT6zH1.js";import"./clock-BMvmk19V.js";import"./file-text-BjTYvuFp.js";import"./message-square-BGDqvfeV.js";import"./pill-DXTK-vPZ.js";const he=()=>{const[h,b]=n.useState([]),[p,v]=n.useState([]),[C,g]=n.useState(!1),[o,r]=n.useState({patient_id:"",consultation_date:"",diagnosis:"",treatment:"",notes:"",follow_up_date:"",doctor_id:""}),[f,j]=n.useState(!1),[w,i]=n.useState("");n.useEffect(()=>{x(),y();const t=localStorage.getItem("doctor_id")||"1";r(s=>({...s,doctor_id:t}))},[]);const x=async()=>{try{const t=localStorage.getItem("token");console.log("Fetching consultations with token:",t?"Present":"Missing");const s=await fetch("/api/consultations",{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(console.log("Consultations response status:",s.status),s.ok){const a=await s.json();console.log("Consultations data:",a),b(a)}else{const a=await s.text();console.error("Consultations error:",s.status,a)}}catch(t){console.error("Error fetching consultations:",t)}},y=async()=>{try{const t=localStorage.getItem("token"),s=await fetch("/api/patients",{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(s.ok){const a=await s.json();v(a)}}catch(t){console.error("Error fetching patients:",t)}},S=async t=>{if(t.preventDefault(),i(""),!o.patient_id||!o.consultation_date||!o.diagnosis){i("Please fill in all required fields (Patient, Date, and Diagnosis)");return}j(!0);try{const s=localStorage.getItem("token"),a={...o,doctor_id:o.doctor_id||localStorage.getItem("doctor_id")||"1"};console.log("Submitting consultation:",{submitData:a});const c=await fetch("/api/consultations",{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(a)});if(c.ok)await x(),N(),i(""),alert("Consultation added successfully!");else{const d=await c.json().catch(()=>({message:"Unknown error occurred"}));console.error("Error response:",d),i(d.message||"Failed to save consultation. Please try again.")}}catch(s){console.error("Network error details:",s),i("Network error: "+s.message)}finally{j(!1)}},_=async t=>{if(console.log("Delete consultation ID:",t),!t){alert("Invalid consultation ID");return}if(confirm("Are you sure you want to delete this consultation?"))try{const s=localStorage.getItem("token");console.log("Deleting consultation with URL:",`/api/consultations/${t}`);const a=await fetch(`/api/consultations/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}});a.ok?(x(),alert("Consultation deleted successfully!")):(console.error("Delete failed with status:",a.status),alert("Failed to delete consultation"))}catch(s){console.error("Error deleting consultation:",s),alert("Error deleting consultation")}},N=()=>{const t=localStorage.getItem("doctor_id")||"1";r({patient_id:"",consultation_date:"",diagnosis:"",treatment:"",notes:"",follow_up_date:"",doctor_id:t}),g(!1),i("")};return e.jsxs(e.Fragment,{children:[e.jsx(k,{children:e.jsx("title",{children:"Consultations - Doctor Dashboard"})}),e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(H,{}),e.jsxs("div",{className:"flex pt-20",children:[e.jsx(U,{}),e.jsx("main",{className:"flex-1 px-6 py-8",children:e.jsxs("div",{className:"container mx-auto max-w-6xl",children:[e.jsxs("div",{className:"mb-8 animate-fade-in-up",children:[e.jsx("h1",{className:"text-4xl font-display font-bold text-gradient mb-4",children:"Consultations"}),e.jsx("p",{className:"text-xl text-muted-foreground",children:"Manage patient consultations and diagnoses"})]}),e.jsxs(I,{className:"shadow-card border-border bg-card",children:[e.jsxs(T,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5 text-primary"}),"Consultation Records"]}),e.jsx(F,{children:"View and manage consultation history"})]}),e.jsxs(m,{onClick:()=>g(!0),className:"gradient-primary shadow-elegant",children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"New Consultation"]})]}),e.jsxs(P,{children:[C&&e.jsxs("form",{onSubmit:S,className:"mb-6 p-4 border border-border rounded-lg bg-muted/30",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"New Consultation"}),e.jsx(m,{type:"button",onClick:N,variant:"ghost",size:"sm",children:e.jsx(D,{className:"h-4 w-4"})})]}),w&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md text-red-700 text-sm",children:w}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{children:"Patient *"}),e.jsxs(L,{value:o.patient_id,onValueChange:t=>r({...o,patient_id:t}),children:[e.jsx($,{children:e.jsx(z,{placeholder:"Select patient"})}),e.jsx(B,{children:p.map(t=>e.jsx(q,{value:t.id.toString(),children:t.name},t.id))})]})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Consultation Date *"}),e.jsx(u,{type:"date",value:o.consultation_date,onChange:t=>r({...o,consultation_date:t.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Diagnosis *"}),e.jsx(u,{value:o.diagnosis,onChange:t=>r({...o,diagnosis:t.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Treatment"}),e.jsx(u,{value:o.treatment,onChange:t=>r({...o,treatment:t.target.value})})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Follow-up Date"}),e.jsx(u,{type:"date",value:o.follow_up_date,onChange:t=>r({...o,follow_up_date:t.target.value})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(l,{children:"Notes"}),e.jsx(A,{value:o.notes,onChange:t=>r({...o,notes:t.target.value})})]}),e.jsx("div",{className:"col-span-2",children:e.jsx(m,{type:"submit",className:"w-full",disabled:f,children:f?"Saving...":"Add Consultation"})})]})]}),e.jsxs("div",{className:"space-y-4",children:[h.map(t=>{const s=p.find(d=>d.id===t.patient_id),a=new Date(t.consultation_date).toLocaleDateString(),c=t.follow_up_date?new Date(t.follow_up_date).toLocaleDateString():null;return e.jsxs("div",{className:"flex justify-between items-start p-4 border border-border rounded-lg bg-muted/50 hover:bg-muted transition-smooth",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-foreground",children:s?s.name:`Patient ID: ${t.patient_id}`}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Date: ",a]}),e.jsxs("p",{className:"text-sm text-primary font-medium",children:["Diagnosis: ",t.diagnosis]}),t.treatment&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Treatment: ",t.treatment]}),c&&e.jsxs("p",{className:"text-sm text-blue-600",children:["Follow-up: ",c]}),t.notes&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1 italic",children:t.notes})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(m,{onClick:()=>_(t.id),size:"sm",variant:"outline",className:"text-red-600 hover:text-red-700",children:e.jsx(O,{className:"h-4 w-4"})})})]},t.id)}),h.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:'No consultations found. Click "New Consultation" to create your first consultation record.'})]})]})]})]})})]}),e.jsx(R,{})]})]})};export{he as default};
