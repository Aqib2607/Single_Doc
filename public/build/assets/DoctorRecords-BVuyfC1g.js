import{c as X,r as o,j as e,B as h,X as G}from"./app-CZEgLpFD.js";import{H as J}from"./Helmet-DN3Zoftl.js";import{C as K,b as Q,c as W,d as Y,a as Z}from"./card-DFx5BNHy.js";import{I as g}from"./input-Blm6OlDT.js";import{L as m}from"./label-miftZGeZ.js";import{T as ee}from"./textarea-CX4U6ecq.js";import{S as N,a as S,b as _,c as C,d as l}from"./select-D8tRWASU.js";import{N as te,F as se}from"./Footer-Bjw2Y91L.js";import{D as ae}from"./DoctorSidebar-j5VNeU9f.js";import{F as L}from"./file-text-SYWGHUBY.js";import{P as re}from"./plus-C7suoxQg.js";import{S as ie}from"./square-pen-ChtGH6We.js";import{T as ne}from"./trash-2-tOVpyRHD.js";import"./index-BdQq_4o_.js";import"./index-Bvg-n_-7.js";import"./Combination-DEIAJigP.js";import"./index-D849cdn3.js";import"./chevron-down-C7GNokiY.js";import"./users-DUM4TGor.js";import"./clock-DFpeTyfe.js";import"./stethoscope-CVh3js6S.js";import"./message-square-27UvQ_K7.js";import"./pill-CGZaujNT.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=X("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),Ee=()=>{const[R,B]=o.useState([]),[v,$]=o.useState([]),[M,b]=o.useState(!1),[p,D]=o.useState(null),[k,T]=o.useState(!1),[E,r]=o.useState(""),[F,x]=o.useState(""),[a,d]=o.useState({patient_id:"",patient_email:"",record_type:"",title:"",description:"",status:"pending",record_date:""}),[u,y]=o.useState(null),[P,z]=o.useState(!1);o.useEffect(()=>{w(),O()},[]);const w=async()=>{try{const t=localStorage.getItem("token"),s=await fetch("/api/medical-records",{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json","Cache-Control":"no-cache"}});if(s.ok){const i=await s.json();B(i)}}catch(t){console.error("Error fetching records:",t)}},O=async()=>{try{const t=localStorage.getItem("token"),s=await fetch("/api/patients",{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json","Cache-Control":"no-cache"}});if(s.ok){const i=await s.json();$(i)}}catch(t){console.error("Error fetching patients:",t)}},A=async t=>{if(t.preventDefault(),r(""),!a.patient_id||!a.record_type||!a.title||!a.record_date){r("Please fill in all required fields");return}if(a.patient_email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.patient_email)){r("Please enter a valid email address");return}T(!0);try{const s=localStorage.getItem("token"),i=p?`/api/medical-records/${p.id}`:"/api/medical-records",j=p?"PUT":"POST",c=new FormData;Object.keys(a).forEach(n=>{a[n]&&c.append(n,a[n])}),u&&c.append("medical_file",u),z(!0);const f=await fetch(i,{method:j,headers:{Authorization:`Bearer ${s}`},body:c});if(f.ok)await w(),I(),x(p?"Record updated successfully!":"Record added successfully!"),setTimeout(()=>x(""),3e3);else{const n=await f.json().catch(()=>({message:"Unknown error occurred"}));r(n.message||"Failed to save record")}}catch(s){r("Network error: "+s.message)}finally{T(!1),z(!1)}},U=t=>{var s;D(t),d({patient_id:((s=t.patient_id)==null?void 0:s.toString())||"",patient_email:t.patient_email||"",record_type:t.record_type||"",title:t.title||"",description:t.description||"",status:t.status||"pending",record_date:t.record_date||""}),y(null),b(!0),r("")},q=async t=>{if(confirm("Are you sure you want to delete this record?"))try{const s=localStorage.getItem("token");(await fetch(`/api/medical-records/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}})).ok?(w(),x("Record deleted successfully!"),setTimeout(()=>x(""),3e3)):r("Failed to delete record")}catch(s){console.error("Error deleting record:",s)}},I=()=>{d({patient_id:"",patient_email:"",record_type:"",title:"",description:"",status:"pending",record_date:""}),y(null),D(null),b(!1),r(""),x("")},V=t=>{const s=t.target.files[0];if(s){if(s.size>10*1024*1024){r("File size must be less than 10MB");return}if(!["application/pdf","image/jpeg","image/png","image/jpg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(s.type)){r("Only PDF, DOC, DOCX, and image files are allowed");return}y(s),r("")}},H=t=>{const s=v.find(i=>i.patient_id.toString()===t);d({...a,patient_id:t,patient_email:(s==null?void 0:s.email)||""})};return e.jsxs(e.Fragment,{children:[e.jsx(J,{children:e.jsx("title",{children:"Medical Records - Doctor Dashboard"})}),e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(te,{}),e.jsxs("div",{className:"flex pt-20",children:[e.jsx(ae,{}),e.jsx("main",{className:"flex-1 px-6 py-8",children:e.jsxs("div",{className:"container mx-auto max-w-6xl",children:[e.jsxs("div",{className:"mb-8 animate-fade-in-up",children:[e.jsx("h1",{className:"text-4xl font-display font-bold text-gradient mb-4",children:"Medical Records"}),e.jsx("p",{className:"text-xl text-muted-foreground",children:"Manage patient medical records and documents"})]}),e.jsxs(K,{className:"shadow-card border-border bg-card",children:[e.jsxs(Q,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(W,{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-5 w-5 text-primary"}),"Patient Records"]}),e.jsx(Y,{children:"View and manage medical documents"})]}),e.jsxs(h,{onClick:()=>b(!0),className:"gradient-primary shadow-elegant",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Add Record"]})]}),e.jsxs(Z,{children:[M&&e.jsxs("form",{onSubmit:A,className:"mb-6 p-4 border border-border rounded-lg bg-muted/30",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:p?"Edit Record":"New Medical Record"}),e.jsx(h,{type:"button",onClick:I,variant:"ghost",size:"sm",children:e.jsx(G,{className:"h-4 w-4"})})]}),E&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md text-red-700 text-sm",children:E}),F&&e.jsx("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-md text-green-700 text-sm",children:F}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{children:"Patient *"}),e.jsxs(N,{value:a.patient_id,onValueChange:H,children:[e.jsx(S,{children:e.jsx(_,{placeholder:"Select patient"})}),e.jsx(C,{children:v.map(t=>e.jsx(l,{value:t.patient_id.toString(),children:t.name},t.patient_id))})]})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Patient Email"}),e.jsx(g,{type:"email",value:a.patient_email,onChange:t=>d({...a,patient_email:t.target.value}),placeholder:"patient@example.com"})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Record Type *"}),e.jsxs(N,{value:a.record_type,onValueChange:t=>d({...a,record_type:t}),children:[e.jsx(S,{children:e.jsx(_,{placeholder:"Select type"})}),e.jsxs(C,{children:[e.jsx(l,{value:"Lab Report",children:"Lab Report"}),e.jsx(l,{value:"X-Ray",children:"X-Ray"}),e.jsx(l,{value:"MRI",children:"MRI"}),e.jsx(l,{value:"CT Scan",children:"CT Scan"}),e.jsx(l,{value:"Blood Test",children:"Blood Test"}),e.jsx(l,{value:"Other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Title *"}),e.jsx(g,{value:a.title,onChange:t=>d({...a,title:t.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Record Date *"}),e.jsx(g,{type:"date",value:a.record_date,onChange:t=>d({...a,record_date:t.target.value}),max:new Date().toISOString().split("T")[0],required:!0})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Status"}),e.jsxs(N,{value:a.status,onValueChange:t=>d({...a,status:t}),children:[e.jsx(S,{children:e.jsx(_,{})}),e.jsxs(C,{children:[e.jsx(l,{value:"pending",children:"Pending"}),e.jsx(l,{value:"complete",children:"Complete"}),e.jsx(l,{value:"reviewed",children:"Reviewed"})]})]})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Medical Document"}),e.jsx(g,{type:"file",onChange:V,accept:".pdf,.doc,.docx,.jpg,.jpeg,.png",className:"file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary file:text-primary-foreground hover:file:bg-primary/80"}),u&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Selected: ",u.name," (",(u.size/1024/1024).toFixed(2)," MB)"]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(m,{children:"Description"}),e.jsx(ee,{value:a.description,onChange:t=>d({...a,description:t.target.value})})]}),e.jsx("div",{className:"col-span-2",children:e.jsx(h,{type:"submit",className:"w-full",disabled:k||P,children:P?"Uploading...":k?"Saving...":p?"Update Record":"Add Record"})})]})]}),e.jsxs("div",{className:"space-y-4",children:[R.map(t=>{const s=v.find(j=>j.patient_id===t.patient_id),i=new Date(t.record_date).toLocaleDateString();return e.jsxs("div",{className:"flex justify-between items-start p-4 border border-border rounded-lg bg-muted/50 hover:bg-muted transition-smooth",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-foreground",children:s?s.name:`Patient ID: ${t.patient_id}`}),e.jsx("p",{className:"text-sm text-primary font-medium",children:t.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Type: ",t.record_type," | Date: ",i]}),t.patient_email&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Email: ",t.patient_email]}),e.jsxs("p",{className:`text-sm capitalize ${t.status==="complete"?"text-green-600":t.status==="reviewed"?"text-blue-600":"text-yellow-600"}`,children:["Status: ",t.status]}),t.file_path&&e.jsxs("p",{className:"text-sm text-blue-600 flex items-center gap-1",children:[e.jsx(L,{className:"h-3 w-3"}),"Document attached"]}),t.description&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1 italic",children:t.description})]}),e.jsxs("div",{className:"flex gap-2",children:[t.file_path&&e.jsx(h,{onClick:()=>{const j=localStorage.getItem("token");fetch(`/api/medical-records/${t.id}/download`,{headers:{Authorization:`Bearer ${j}`}}).then(c=>c.blob()).then(c=>{const f=window.URL.createObjectURL(c),n=document.createElement("a");n.href=f,n.download=t.title||"medical_record",document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(f),document.body.removeChild(n)}).catch(c=>console.error("Download failed:",c))},size:"sm",variant:"outline",className:"text-blue-600 hover:text-blue-700",children:e.jsx(oe,{className:"h-4 w-4"})}),e.jsx(h,{onClick:()=>U(t),size:"sm",variant:"outline",children:e.jsx(ie,{className:"h-4 w-4"})}),e.jsx(h,{onClick:()=>q(t.id),size:"sm",variant:"outline",className:"text-red-600 hover:text-red-700",children:e.jsx(ne,{className:"h-4 w-4"})})]})]},t.id)}),R.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:'No medical records found. Click "Add Record" to create your first record.'})]})]})]})]})})]}),e.jsx(se,{})]})]})};export{Ee as default};
